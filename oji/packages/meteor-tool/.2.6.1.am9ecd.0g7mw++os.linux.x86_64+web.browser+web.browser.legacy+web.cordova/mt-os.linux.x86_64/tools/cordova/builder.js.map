{"version":3,"sources":["/tools/cordova/builder.js"],"names":["_objectSpread","module","link","default","v","_defineProperty","export","CordovaBuilder","_","util","url","path","Console","buildmessage","files","optimisticReadJsonOrNull","bundler","archinfo","release","loadIsopackage","utils","XmlBuilder","CORDOVA_ARCH","SWIFT_VERSION","iconsIosSizes","iconsAndroidSizes","splashIosKeys","splashAndroidKeys","constructor","projectContext","projectRoot","options","suppliedPath","key","tag","suppliedFilename","last","split","pathSep","extension","match","resourcesPath","pathJoin","initalizeDefaults","createCordovaServerPort","appIdentifier","appIdAsNumber","parseInt","cordovaServerPort","metadata","id","version","buildNumber","undefined","name","pathBasename","projectDir","description","author","email","website","contentUrl","additionalConfiguration","global","platform","ios","android","custom","resourceFiles","packageMap","getInfo","AutoHideSplashScreen","SplashScreen","SplashScreenDelay","FadeSplashScreenDuration","ShowSplashScreenSpinner","StatusBarOverlaysWebView","StatusBarStyle","accessRules","type","mobileServerUrl","serverDomain","parseUrl","hostname","isIPv4Address","imagePaths","icon","splash","assetsPath","__dirname","iconsPath","launchScreensPath","setDefaultIcon","size","imageFile","exists","setDefaultLaunchScreen","each","pluginsConfiguration","processControlFile","controlFilePath","debug","enterJob","title","code","readFile","runJavaScript","filename","symbols","App","createAppConfiguration","error","exception","writeConfigXmlAndCopyResources","shouldCopyResources","config","create","ele","xmlns","value","att","txt","href","toString","elementSet","src","pattern","omit","Object","assign","origin","platformElement","prefs","process","env","NODE_ENV","rm_recursive","mkdir_p","_configureAndCopyIcon","_configureAndCopySplashImages","configureAndCopyResourceFiles","configXmlPath","formattedXmlConfig","end","prettyPrint","writeFile","_copyImageToBuildFolderAndAppendToXmlNode","newFilename","xmlElement","attributes","copyFile","pathResolve","sizes","Error","entries","forEach","width","height","_resolveFilenameForImages","allowedValues","isIos","appendDarkMode","stringValue","separator","withChar","darkModeIdentifier","lastIndexOfSeparator","lastIndexOf","substring","suppliedValue","suppliedPathDarkMode","srcDarkMode","density","iosElement","androidElement","resourceFile","filepath","target","copyWWW","bundlePath","wwwPath","applicationPath","programPath","cp_r","programJsonPath","convertToOSPath","program","JSON","parse","settingsFile","settings","publicSettings","appendVersion","stringify","bootstrapPage","generateBootstrapPage","await","configDummy","PUBLIC_SETTINGS","WebAppHashing","AUTOUPDATE_VERSION","calculateClientHash","manifest","versionRefreshable","versionNonRefreshable","replaceable","versionReplaceable","_type","meteorRelease","current","isCheckout","hmrVersion","buildMode","Date","now","parsedUrl","runtimeConfig","gitCommitHash","METEOR_GIT_COMMIT_HASH","findGitCommitHash","ROOT_URL","ROOT_URL_PATH_PREFIX","pathname","replace","DDP_DEFAULT_CONNECTION_URL","autoupdate","versions","versionHmr","appId","meteorEnv","TEST_METADATA","Boilerplate","boilerplate","urlMapper","identity","pathMapper","baseDataExtension","meteorRuntimeConfig","encodeURIComponent","toHTMLAsync","copyBuildOverride","buildOverridePath","stat","isDirectory","builder","info","has","setPreference","includes","configurePlugin","icons","validDevices","keys","concat","include","labelWarn","launchScreens","accessRule","launchExternal","appendToConfig","xml","push","addResourceFile"],"mappings":"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","sourcesContent":["import _ from 'underscore';\nimport util from 'util';\nimport url from 'url';\nimport path from 'path';\nimport { Console } from '../console/console.js';\nimport buildmessage from '../utils/buildmessage.js';\nimport files from '../fs/files';\nimport { optimisticReadJsonOrNull } from \"../fs/optimistic\";\nimport bundler from '../isobuild/bundler.js';\nimport archinfo from '../utils/archinfo';\nimport release from '../packaging/release.js';\nimport { loadIsopackage } from '../tool-env/isopackets.js';\nimport utils from '../utils/utils.js';\nimport XmlBuilder from 'xmlbuilder2';\n\nimport { CORDOVA_ARCH, SWIFT_VERSION } from './index.js';\n\n// Hard-coded size constants\n\nconst iconsIosSizes = {\n  'app_store': '1024x1024',\n  'iphone_2x': '120x120',\n  'iphone_3x': '180x180',\n  'ipad_2x': '152x152',\n  'ipad_pro': '167x167',\n  'ios_settings_2x': '58x58',\n  'ios_settings_3x': '87x87',\n  'ios_spotlight_2x': '80x80',\n  'ios_spotlight_3x': '120x120',\n  'ios_notification_2x': '40x40',\n  'ios_notification_3x': '60x60',\n  // Legacy\n  'ipad': '76x76',\n  'ios_settings': '29x29',\n  'ios_spotlight': '40x40',\n  'ios_notification': '20x20',\n  'iphone_legacy': '57x57',\n  'iphone_legacy_2x': '114x114',\n  'ipad_spotlight_legacy': '50x50',\n  'ipad_spotlight_legacy_2x': '100x100',\n  'ipad_app_legacy': '72x72',\n  'ipad_app_legacy_2x': '144x144'\n};\n\nconst iconsAndroidSizes = {\n  'android_mdpi': '48x48',\n  'android_hdpi': '72x72',\n  'android_xhdpi': '96x96',\n  'android_xxhdpi': '144x144',\n  'android_xxxhdpi': '192x192'\n};\n\nconst splashIosKeys = {\n  'ios_universal': 'Default@2x~universal~anyany.png',\n  'ios_universal_3x': 'Default@3x~universal~anyany.png',\n  'Default@2x~universal~comany': 'Default@2x~universal~comany.png',\n  'Default@2x~universal~comcom': 'Default@2x~universal~comcom.png',\n  'Default@3x~universal~anycom': 'Default@3x~universal~anycom.png',\n  'Default@3x~universal~comany': 'Default@3x~universal~comany.png',\n  'Default@2x~iphone~anyany': 'Default@2x~iphone~anyany.png',\n  'Default@2x~iphone~comany': 'Default@2x~iphone~comany.png',\n  'Default@2x~iphone~comcom': 'Default@2x~iphone~comcom.png',\n  'Default@3x~iphone~anyany': 'Default@3x~iphone~anyany.png',\n  'Default@3x~iphone~anycom': 'Default@3x~iphone~anycom.png',\n  'Default@3x~iphone~comany': 'Default@3x~iphone~comany.png',\n  'Default@2x~ipad~anyany': 'Default@2x~ipad~anyany.png',\n  'Default@2x~ipad~comany': 'Default@2x~ipad~comany.png'\n};\n\nconst splashAndroidKeys = {\n  'android_mdpi_portrait': 'port-mdpi',\n  'android_mdpi_landscape': 'land-mdpi',\n  'android_hdpi_portrait': 'port-hdpi',\n  'android_hdpi_landscape': 'land-hdpi',\n  'android_xhdpi_portrait': 'port-xhdpi',\n  'android_xhdpi_landscape': 'land-xhdpi',\n  'android_xxhdpi_portrait': 'port-xxhdpi',\n  'android_xxhdpi_landscape': 'land-xxhdpi',\n  'android_xxxhdpi_portrait': 'port-xxxhdpi',\n  'android_xxxhdpi_landscape': 'land-xxxhdpi'\n};\n\nexport class CordovaBuilder {\n  constructor(projectContext, projectRoot, options) {\n    this.projectContext = projectContext;\n    this.projectRoot = projectRoot;\n    this.options = options;\n\n    this.resourcesPath = files.pathJoin(\n      this.projectRoot,\n      'resources');\n\n    this.initalizeDefaults();\n  }\n\n  static createCordovaServerPort(appIdentifier) {\n    // Convert the appId (a base 36 string) to a number\n    const appIdAsNumber = parseInt(appIdentifier, 36);\n    // We use the appId to choose a local server port between 12000-13000.\n    // This range should be large enough to avoid collisions with other\n    // Meteor apps, and has also been chosen to avoid collisions\n    // with other apps or services on the device (although this can never be\n    // guaranteed).\n    return 12000 + (appIdAsNumber % 1000);\n  }\n\n  initalizeDefaults() {\n    let { cordovaServerPort } = this.options;\n    // if --cordova-server-port is not present on run command\n    if (!cordovaServerPort) {\n      cordovaServerPort = CordovaBuilder.createCordovaServerPort(\n        this.projectContext.appIdentifier\n      );\n    }\n\n    this.metadata = {\n      id: 'com.id' + this.projectContext.appIdentifier,\n      version: '0.0.1',\n      buildNumber: undefined,\n      name: files.pathBasename(this.projectContext.projectDir),\n      description: 'New Meteor Mobile App',\n      author: 'A Meteor Developer',\n      email: 'n/a',\n      website: 'n/a',\n      contentUrl: `http://localhost:${cordovaServerPort}/`\n    };\n\n    // Set some defaults different from the Cordova defaults\n    this.additionalConfiguration = {\n      global: {\n        'webviewbounce': false,\n        'DisallowOverscroll': true,\n        'WKWebViewOnly': true,\n        'SwiftVersion': SWIFT_VERSION\n      },\n      platform: {\n        ios: {},\n        android: {\n          \"AndroidXEnabled\": true,\n          // we still use a port based on appId on iOS to avoid conflits on local webserver\n          // we dont need it on android, but the contentUrl can only be one, and we set this\n          // here to be able to intercept these calls\n          \"hostname\": `localhost:${cordovaServerPort}`,\n          \"AndroidInsecureFileModeEnabled\": true\n        }\n      }\n    };\n\n    // Custom elements that will be appended into config.xml's widgets\n    this.custom = [];\n\n    // Resource files that will be appended to platform bundle and config.xml\n    this.resourceFiles = [];\n\n    const packageMap = this.projectContext.packageMap;\n\n    if (packageMap && packageMap.getInfo('launch-screen')) {\n      this.additionalConfiguration.global.AutoHideSplashScreen = false;\n      this.additionalConfiguration.global.SplashScreen = 'screen';\n      this.additionalConfiguration.global.SplashScreenDelay = 5000;\n      this.additionalConfiguration.global.FadeSplashScreenDuration = 250;\n      this.additionalConfiguration.global.ShowSplashScreenSpinner = false;\n    }\n\n    if (packageMap && packageMap.getInfo('mobile-status-bar')) {\n      this.additionalConfiguration.global.StatusBarOverlaysWebView = false;\n      this.additionalConfiguration.global.StatusBarStyle = 'default';\n    }\n\n    // Default access rules.\n    // Rules can be extended with App.accessRule() in mobile-config.js.\n    this.accessRules = {\n      // Allow the app to ask the system to open these types of URLs.\n      // (e.g. in the phone app or an email client)\n      'tel:*': { type: 'intent' },\n      'geo:*': { type: 'intent' },\n      'mailto:*': { type: 'intent' },\n      'sms:*': { type: 'intent' },\n      'market:*': { type: 'intent' },\n      'itms:*': { type: 'intent' },\n      'itms-apps:*': { type: 'intent' },\n\n      // Allow navigation to localhost, which is needed for the local server\n      'http://localhost': { type: 'navigation' }\n    };\n\n    const mobileServerUrl = this.options.mobileServerUrl;\n    const serverDomain = mobileServerUrl ?\n      utils.parseUrl(mobileServerUrl).hostname : null;\n\n    // If the remote server domain is known, allow access to it for XHR and DDP\n    // connections.\n    if (serverDomain) {\n      // Application Transport Security (new in iOS 9) doesn't allow you\n      // to give access to IP addresses (just domains). So we allow access to\n      // everything if we don't have a domain, which sets NSAllowsArbitraryLoads.\n      if (utils.isIPv4Address(serverDomain)) {\n        this.accessRules['*'] = { type: 'network' };\n      } else {\n        this.accessRules['*://' + serverDomain] = { type: 'network' };\n\n        // Android talks to localhost over 10.0.2.2. This config file is used for\n        // multiple platforms, so any time that we say the server is on localhost we\n        // should also say it is on 10.0.2.2.\n        if (serverDomain === 'localhost') {\n          this.accessRules['*://10.0.2.2'] = { type: 'network' };\n        }\n      }\n    }\n\n    this.imagePaths = {\n      icon: {},\n      splash: {}\n    };\n\n    // Defaults are Meteor meatball images located in tools/cordova/assets directory\n    const assetsPath = files.pathJoin(__dirname, 'assets');\n    const iconsPath = files.pathJoin(assetsPath, 'icons');\n    const launchScreensPath = files.pathJoin(assetsPath, 'launchscreens');\n\n    const setDefaultIcon = (size, name) => {\n      const imageFile = files.pathJoin(iconsPath, size + '.png');\n      if (files.exists(imageFile)) {\n        this.imagePaths.icon[name] = imageFile;\n      }\n    };\n\n    const setDefaultLaunchScreen = (key) => {\n      const imageFile = files.pathJoin(launchScreensPath, `${key}.png`);\n      if (files.exists(imageFile)) {\n        this.imagePaths.splash[key] = imageFile;\n      }\n    };\n\n    _.each(iconsIosSizes, setDefaultIcon);\n    _.each(iconsAndroidSizes, setDefaultIcon);\n\n    setDefaultLaunchScreen('ios_universal');\n    setDefaultLaunchScreen('android_mdpi_portrait');\n\n    this.pluginsConfiguration = {};\n  }\n\n  processControlFile() {\n    const controlFilePath =\n      files.pathJoin(this.projectContext.projectDir, 'mobile-config.js');\n\n\n    if (files.exists(controlFilePath)) {\n      Console.debug('Processing mobile-config.js');\n\n      buildmessage.enterJob({ title: `processing mobile-config.js` }, () => {\n        const code = files.readFile(controlFilePath, 'utf8');\n\n        try {\n          files.runJavaScript(code, {\n            filename: 'mobile-config.js',\n            symbols: { App: createAppConfiguration(this) }\n          });\n        } catch (error) {\n          buildmessage.exception(error);\n        }\n      });\n    }\n  }\n\n  writeConfigXmlAndCopyResources(shouldCopyResources = true) {\n    let config = XmlBuilder.create({ version: '1.0' }).ele('widget');\n\n    // Set the root attributes\n    _.each({\n      id: this.metadata.id,\n      version: this.metadata.version,\n      'android-versionCode': this.metadata.buildNumber,\n      'ios-CFBundleVersion': this.metadata.buildNumber,\n      xmlns: 'http://www.w3.org/ns/widgets',\n      'xmlns:cdv': 'http://cordova.apache.org/ns/1.0',\n      'xmlns:android': 'http://schemas.android.com/apk/res/android'\n    }, (value, key) => {\n      if (value) {\n        config.att(key, value);\n      }\n    });\n\n    // Set the metadata\n    config.ele('name').txt(this.metadata.name);\n    config.ele('description').txt(this.metadata.description);\n    config.ele('author', {\n      href: this.metadata.website,\n      email: this.metadata.email\n    }).txt(this.metadata.author);\n\n    // Set the additional global configuration preferences\n    _.each(this.additionalConfiguration.global, (value, key) => {\n      config.ele('preference', {\n        name: key,\n        value: value.toString()\n      });\n    });\n\n    // Set custom tags into widget element\n    _.each(this.custom, elementSet => {\n      const tag = config.ele(elementSet);\n    });\n\n    config.ele('content', { src: this.metadata.contentUrl });\n\n    // Copy all the access rules\n    _.each(this.accessRules, (options, pattern) => {\n      const type = options.type;\n      options = _.omit(options, 'type');\n\n      if (type === 'intent') {\n        config.ele('allow-intent', { href: pattern });\n      } else if (type === 'navigation') {\n        config.ele('allow-navigation', Object.assign({ href: pattern }, options));\n      } else {\n        config.ele('access', Object.assign({ origin: pattern }, options));\n      }\n    });\n\n    const platformElement = {\n      ios: config.ele('platform', { name: 'ios' }),\n      android: config.ele('platform', { name: 'android' })\n    }\n\n    // Set the additional platform-specific configuration preferences\n    _.each(this.additionalConfiguration.platform, (prefs, platform) => {\n      _.each(prefs, (value, key) => {\n        platformElement[platform].ele('preference', {\n          name: key,\n          value: value.toString()\n        });\n      });\n    });\n\n    // allow http communication only in development mode\n    if(process.env.NODE_ENV !== 'production') {\n      platformElement.android.ele(\"edit-config\")\n          .att(\"file\", \"app/src/main/AndroidManifest.xml\")\n          .att(\"mode\", \"merge\")\n          .att(\"target\", \"/manifest/application\")\n          .ele(\"application\")\n          .att(\"android:usesCleartextTraffic\", \"true\");\n    }\n    if (shouldCopyResources) {\n      // Prepare the resources folder\n      files.rm_recursive(this.resourcesPath);\n      files.mkdir_p(this.resourcesPath);\n\n      Console.debug('Copying resources for mobile apps');\n\n      this._configureAndCopyIcon(iconsIosSizes, platformElement.ios);\n      this._configureAndCopyIcon(iconsAndroidSizes, platformElement.android);\n      this._configureAndCopySplashImages(splashIosKeys, platformElement.ios, true);\n      this._configureAndCopySplashImages(splashAndroidKeys, platformElement.android);\n    }\n\n    this.configureAndCopyResourceFiles(\n      this.resourceFiles,\n      platformElement.ios,\n      platformElement.android\n    );\n\n    Console.debug('Writing new config.xml');\n\n    const configXmlPath = files.pathJoin(this.projectRoot, 'config.xml');\n    const formattedXmlConfig = config.end({ prettyPrint: true });\n    files.writeFile(configXmlPath, formattedXmlConfig, 'utf8');\n  }\n\n  _copyImageToBuildFolderAndAppendToXmlNode(suppliedPath, newFilename, xmlElement, tag, attributes = {}) {\n    const src = files.pathJoin('resources', newFilename);\n\n    files.copyFile(\n        files.pathResolve(this.projectContext.projectDir, suppliedPath),\n        files.pathJoin(this.resourcesPath, newFilename));\n\n    // Set it to the xml tree\n    xmlElement.ele(tag, { src, ...attributes });\n  }\n\n  _resolveFilenameForImages = (suppliedPath, key, tag) => {\n    const suppliedFilename = _.last(suppliedPath.split(files.pathSep));\n    let extension = _.last(suppliedFilename.split('.'));\n\n    // XXX special case for 9-patch png's\n    if (suppliedFilename.match(/\\.9\\.png$/)) {\n      extension = '9.png';\n    }\n\n    return `${key}.${tag}.${extension}`;\n  }\n\n  _configureAndCopyIcon(sizes, xmlElement) {\n    if (!sizes || !xmlElement) {\n      throw new Error(\"Invalid parameters\")\n    }\n\n    Object.entries(sizes).forEach(([key, size]) => {\n      const suppliedPath = this.imagePaths['icon'][key];\n      if (!suppliedPath) return;\n\n      const [width, height] = size.split('x');\n      const filename = this._resolveFilenameForImages(suppliedPath, key, 'icon');\n      this._copyImageToBuildFolderAndAppendToXmlNode(suppliedPath, filename, xmlElement, 'icon', { width, height })\n    })\n  }\n\n  _configureAndCopySplashImages(allowedValues, xmlElement, isIos = false) {\n    const appendDarkMode = (stringValue , { separator = '.', withChar = '~' } = {}) => {\n      if (!stringValue) {\n        throw new Error(\"No string was passed.\");\n      }\n\n      const darkModeIdentifier = isIos ? 'dark' : 'night';\n      const lastIndexOfSeparator = stringValue.lastIndexOf(separator);\n\n      if (!lastIndexOfSeparator) {\n        throw new Error(\"Invalid src value!\");\n      }\n\n      return `${stringValue.substring(0, lastIndexOfSeparator)}${withChar}${darkModeIdentifier}${stringValue.substring(lastIndexOfSeparator)}`;\n    }\n\n    Object.entries(allowedValues).forEach(([key, value]) => {\n      const suppliedValue = this.imagePaths['splash'][key];\n      if (!suppliedValue) return;\n\n      let suppliedPath = suppliedValue;\n      let suppliedPathDarkMode = null;\n      if (typeof suppliedValue === 'object') {\n        suppliedPath = suppliedValue.src;\n        suppliedPathDarkMode = suppliedValue.srcDarkMode;\n      }\n\n      if (isIos) {\n        if (suppliedPathDarkMode) {\n          this._copyImageToBuildFolderAndAppendToXmlNode(suppliedPathDarkMode,\n              appendDarkMode(value),\n              xmlElement,\n              'splash');\n        }\n        this._copyImageToBuildFolderAndAppendToXmlNode(suppliedPath,\n            value,\n            xmlElement,\n            'splash');\n        return;\n      }\n\n      const filename = this._resolveFilenameForImages(suppliedPath, key, 'splash');\n      if (suppliedPathDarkMode) {\n        this._copyImageToBuildFolderAndAppendToXmlNode(suppliedPathDarkMode,\n            appendDarkMode(filename, { withChar: '_' }),\n            xmlElement, 'splash',\n            { density: appendDarkMode(value, { separator: '-', withChar: '-' })}\n        );\n      }\n      this._copyImageToBuildFolderAndAppendToXmlNode(suppliedPath,\n          filename,\n          xmlElement,\n          'splash',\n          { density: value });\n    })\n  }\n\n  configureAndCopyResourceFiles(resourceFiles, iosElement, androidElement) {\n    _.each(resourceFiles, resourceFile => {\n      // Copy resource files in cordova project root ./resource-files directory keeping original absolute path\n      var filepath = files.pathResolve(this.projectContext.projectDir, resourceFile.src);\n      files.copyFile(\n        filepath,\n        files.pathJoin(this.projectRoot, \"resource-files\", filepath));\n      // And entry in config.xml\n      if (!resourceFile.platform ||\n          (resourceFile.platform && resourceFile.platform === \"android\")) {\n        androidElement.ele('resource-file', {\n          src: files.pathJoin(\"resource-files\", filepath),\n          target: resourceFile.target\n        });\n      }\n      if (!resourceFile.platform ||\n          (resourceFile.platform && resourceFile.platform === \"ios\")) {\n        iosElement.ele('resource-file', {\n          src: files.pathJoin(\"resource-files\", filepath),\n          target: resourceFile.target\n        });\n      }\n    });\n  }\n\n  copyWWW(bundlePath) {\n    const wwwPath = files.pathJoin(this.projectRoot, 'www');\n\n    // Remove existing www\n    files.rm_recursive(wwwPath);\n\n    // Create www and www/application directories\n    const applicationPath = files.pathJoin(wwwPath, 'application');\n    files.mkdir_p(applicationPath);\n\n    // Copy Cordova arch program from bundle to www/application\n    const programPath = files.pathJoin(bundlePath, 'programs', CORDOVA_ARCH);\n    files.cp_r(programPath, applicationPath);\n\n    // Load program.json\n    const programJsonPath = files.convertToOSPath(\n      files.pathJoin(applicationPath, 'program.json'));\n    const program = JSON.parse(files.readFile(programJsonPath, 'utf8'));\n\n    // Load settings\n    const settingsFile = this.options.settingsFile;\n    const settings = settingsFile ?\n      JSON.parse(files.readFile(settingsFile, 'utf8')) : {};\n    const publicSettings = settings['public'];\n\n    // Calculate client hash and append to program\n    this.appendVersion(program, publicSettings);\n\n    // Write program.json\n    files.writeFile(programJsonPath, JSON.stringify(program), 'utf8');\n\n    const bootstrapPage = this.generateBootstrapPage(\n      applicationPath, program, publicSettings\n    ).await();\n\n    files.writeFile(files.pathJoin(applicationPath, 'index.html'),\n      bootstrapPage, 'utf8');\n  }\n\n  appendVersion(program, publicSettings) {\n    // Note: these version calculations must be kept in agreement with\n    // generateClientProgram in packages/webapp/webapp_server.js, or hot\n    // code push will reload the app unnecessarily.\n\n    let configDummy = {};\n    configDummy.PUBLIC_SETTINGS = publicSettings || {};\n\n    const { WebAppHashing } = loadIsopackage('webapp-hashing');\n    const { AUTOUPDATE_VERSION } = process.env;\n\n    program.version = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest, null, configDummy);\n\n    program.versionRefreshable = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest, type => type === \"css\", configDummy);\n\n    program.versionNonRefreshable = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest,\n        (type, replaceable) => type !== \"css\" && !replaceable,\n        configDummy\n      );\n\n    program.versionReplaceable = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest,\n        (_type, replaceable) => replaceable,\n        configDummy\n      );\n  }\n\n  generateBootstrapPage(applicationPath, program, publicSettings) {\n    const meteorRelease =\n      release.current.isCheckout() ? \"none\" : release.current.name;\n    const hmrVersion =\n      this.options.buildMode === 'development' ? Date.now() : undefined\n\n    const manifest = program.manifest;\n\n    const mobileServerUrl = this.options.mobileServerUrl;\n\n    const parsedUrl = url.parse(mobileServerUrl);\n\n    const runtimeConfig = {\n      meteorRelease: meteorRelease,\n      gitCommitHash: process.env.METEOR_GIT_COMMIT_HASH || files.findGitCommitHash(applicationPath),\n      ROOT_URL: mobileServerUrl,\n      // XXX propagate it from this.options?\n      ROOT_URL_PATH_PREFIX: parsedUrl.pathname.replace(/\\/$/,\"\") || '',\n      DDP_DEFAULT_CONNECTION_URL: process.env.DDP_DEFAULT_CONNECTION_URL || mobileServerUrl,\n      autoupdate: {\n        versions: {\n          \"web.cordova\": {\n            version: program.version,\n            versionRefreshable: program.versionRefreshable,\n            versionNonRefreshable: program.versionNonRefreshable,\n            versionReplaceable: program.versionReplaceable,\n            versionHmr: hmrVersion\n          }\n        }\n      },\n      appId: this.projectContext.appIdentifier,\n      meteorEnv: {\n        NODE_ENV: process.env.NODE_ENV || \"production\",\n        TEST_METADATA: process.env.TEST_METADATA || \"{}\"\n      }\n    };\n\n    if (publicSettings) {\n      runtimeConfig.PUBLIC_SETTINGS = publicSettings;\n    }\n\n    const { Boilerplate } = loadIsopackage('boilerplate-generator');\n\n    const boilerplate = new Boilerplate(CORDOVA_ARCH, manifest, {\n      urlMapper: _.identity,\n      pathMapper: (path) => files.convertToOSPath(\n        files.pathJoin(applicationPath, path)),\n      baseDataExtension: {\n        meteorRuntimeConfig: JSON.stringify(\n          encodeURIComponent(JSON.stringify(runtimeConfig)))\n      }\n    });\n\n    return boilerplate.toHTMLAsync();\n  }\n\n  copyBuildOverride() {\n    const buildOverridePath =\n      files.pathJoin(this.projectContext.projectDir, 'cordova-build-override');\n\n    if (files.exists(buildOverridePath) &&\n      files.stat(buildOverridePath).isDirectory()) {\n      Console.debug('Copying over the cordova-build-override directory');\n      files.cp_r(buildOverridePath, this.projectRoot);\n    }\n  }\n}\n\nfunction createAppConfiguration(builder) {\n  const { settingsFile } = builder.options;\n  let settings = null;\n  if (settingsFile) {\n    settings = optimisticReadJsonOrNull(settingsFile);\n    if (!settings) {\n      throw new Error(\"Unreadable --settings file: \" + settingsFile);\n    }\n  }\n\n  /**\n   * @namespace App\n   * @global\n   * @summary The App configuration object in mobile-config.js\n   */\n  return {\n    /**\n     * @summary Set your mobile app's core configuration information.\n     * @param {Object} options\n     * @param {String} [options.id,version,name,description,author,email,website]\n     * Each of the options correspond to a key in the app's core configuration\n     * as described in the [Cordova documentation](http://cordova.apache.org/docs/en/5.1.1/config_ref_index.md.html#The%20config.xml%20File_core_configuration_elements).\n     * @memberOf App\n     */\n    info: function (options) {\n      // check that every key is meaningful\n      _.each(options, function (value, key) {\n        if (!_.has(builder.metadata, key)) {\n          throw new Error(\"Unknown key in App.info configuration: \" + key);\n        }\n      });\n\n      Object.assign(builder.metadata, options);\n    },\n    /**\n     * @summary Add a preference for your build as described in the\n     * [Cordova documentation](http://cordova.apache.org/docs/en/5.1.1/config_ref_index.md.html#The%20config.xml%20File_global_preferences).\n     * @param {String} name A preference name supported by Cordova's\n     * `config.xml`.\n     * @param {String} value The value for that preference.\n     * @param {String} [platform] Optional. A platform name (either `ios` or `android`) to add a platform-specific preference.\n     * @memberOf App\n     */\n    setPreference: function (key, value, platform) {\n      if (platform) {\n        if (!['ios', 'android'].includes(platform)) {\n          throw new Error(`Unknown platform in App.setPreference: ${platform}. \\\nValid platforms are: ios, android.`);\n        }\n\n        builder.additionalConfiguration.platform[platform][key] = value;\n      } else {\n        builder.additionalConfiguration.global[key] = value;\n      }\n    },\n\n    /**\n     * @summary Like `Meteor.settings`, contains data read from a JSON\n     *          file provided via the `--settings` command-line option at\n     *          build time, or null if no settings were provided.\n     * @memberOf App\n     * @type {Object}\n     */\n    settings,\n\n    /**\n     * @summary Set the build-time configuration for a Cordova plugin.\n     * @param {String} id The identifier of the plugin you want to\n     * configure.\n     * @param {Object} config A set of key-value pairs which will be passed\n     * at build-time to configure the specified plugin.\n     * @memberOf App\n     */\n    configurePlugin: function (id, config) {\n      builder.pluginsConfiguration[id] = config;\n    },\n\n    /**\n     * @summary Set the icons for your mobile app.\n     * @param {Object} icons An Object where the keys are different\n     * devices and screen sizes, and values are image paths\n     * relative to the project root directory.\n     *\n     * Valid key values:\n     * - `app_store` (1024x1024) // Apple App Store\n     * - `iphone_2x` (120x120) // iPhone 5, SE, 6, 6s, 7, 8\n     * - `iphone_3x` (180x180) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ipad_2x` (152x152) // iPad, iPad mini\n     * - `ipad_pro` (167x167) // iPad Pro\n     * - `ios_settings_2x` (58x58) // iPhone 5, SE, 6, 6s, 7, 8, iPad, mini, Pro\n     * - `ios_settings_3x` (87x87) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ios_spotlight_2x` (80x80) // iPhone 5, SE, 6, 6s, 7, 8, iPad, mini, Pro\n     * - `ios_spotlight_3x` (120x120) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ios_notification_2x` (40x40) // iPhone 5, SE, 6, 6s, 7, 8, iPad, mini, Pro\n     * - `ios_notification_3x` (60x60 // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ipad` (76x76) // Legacy\n     * - `ios_settings` (29x29) // Legacy\n     * - `ios_spotlight` (40x40) // Legacy\n     * - `ios_notification` (20x20) // Legacy\n     * - `iphone_legacy` (57x57) // Legacy\n     * - `iphone_legacy_2x` (114x114) // Legacy\n     * - `ipad_spotlight_legacy` (50x50) // Legacy\n     * - `ipad_spotlight_legacy_2x` (100x100) // Legacy\n     * - `ipad_app_legacy` (72x72) // Legacy\n     * - `ipad_app_legacy_2x` (144x144) // Legacy\n     * - `android_mdpi` (48x48)\n     * - `android_hdpi` (72x72)\n     * - `android_xhdpi` (96x96)\n     * - `android_xxhdpi` (144x144)\n     * - `android_xxxhdpi` (192x192)\n     * @memberOf App\n     */\n    icons: function (icons) {\n      var validDevices =\n        Object.keys(iconsIosSizes).concat(Object.keys(iconsAndroidSizes));\n      _.each(icons, function (value, key) {\n        if (!_.include(validDevices, key)) {\n          Console.labelWarn(`${key}: unknown key in App.icons \\\nconfiguration. The key may be deprecated.`);\n        }\n      });\n      Object.assign(builder.imagePaths.icon, icons);\n    },\n\n    /**\n     * @summary Set the launch screen images for your mobile app.\n     * @param {Object} launchScreens A dictionary where keys are different\n     * devices, screen sizes, and orientations, and the values are image paths\n     * relative to the project root directory or an object containing a dark mode image path too ({src, srcDarkMode}).\n     *\n     * For Android, launch screen images should\n     * be special \"Nine-patch\" image files that specify how they should be\n     * stretched. See the [Android docs](https://developer.android.com/guide/topics/graphics/2d-graphics.html#nine-patch).\n     *\n     * For best practices when developing a splash image, see the [Apple Guidelines](https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/launch-screen/).\n     * To learn more about size classes for iOS, check out the [documentation](https://cordova.apache.org/docs/en/10.x/reference/cordova-plugin-splashscreen/#size-classes) from Cordova.\n     *\n     * Valid key values:\n     *\n     * iOS:\n     *  - `ios_universal` (Default@2xuniversalanyany.png - 2732x2732) - All @2x devices, if device/mode specific is not declared\n     *  - `ios_universal_3x` (Default@3xuniversalanyany.png - 2208x2208) - All @3x devices, if device/mode specific is not declared\n     *  - `Default@2x~universal~comany` (1278x2732) - All @2x devices in portrait mode\n     *  - `Default@2x~universal~comcom` (1334x750) - All @2x devices in landscape (narrow) mode\n     *  - `Default@3x~universal~anycom` (2208x1242) - All @3x devices in landscape (wide) mode\n     *  - `Default@3x~universal~comany` (1242x2208) - All @3x devices in portrait mode\n     *  - `Default@2x~iphone~anyany` (1334x1334) - iPhone SE/6s/7/8/XR\n     *  - `Default@2x~iphone~comany` (750x1334) - iPhone SE/6s/7/8/XR - portrait mode\n     *  - `Default@2x~iphone~comcom` (1334x750) - iPhone SE/6s/7/8/XR - landscape (narrow) mode\n     *  - `Default@3x~iphone~anyany` (2208x2208) - iPhone 6s Plus/7 Plus/8 Plus/X/XS/XS Max\n     *  - `Default@3x~iphone~anycom` (2208x1242) - iPhone 6s Plus/7 Plus/8 Plus/X/XS/XS Max - landscape (wide) mode\n     *  - `Default@3x~iphone~comany` (1242x2208) - iPhone 6s Plus/7 Plus/8 Plus/X/XS/XS Max - portrait mode\n     *  - `Default@2x~ipad~anyany` (2732x2732) - iPad Pro 12.9\"/11\"/10.5\"/9.7\"/7.9\"\n     *  - `Default@2x~ipad~comany` (1278x2732) - iPad Pro 12.9\"/11\"/10.5\"/9.7\"/7.9\" - portrait mode\n     *\n     * Android:\n     *  - `android_mdpi_portrait` (320x480)\n     *  - `android_mdpi_landscape` (480x320)\n     *  - `android_hdpi_portrait` (480x800)\n     *  - `android_hdpi_landscape` (800x480)\n     *  - `android_xhdpi_portrait` (720x1280)\n     *  - `android_xhdpi_landscape` (1280x720)\n     *  - `android_xxhdpi_portrait` (960x1600)\n     *  - `android_xxhdpi_landscape` (1600x960)\n     *  - `android_xxxhdpi_portrait` (1280x1920)\n     *  - `android_xxxhdpi_landscape` (1920x1280)\n     *\n     * @memberOf App\n     */\n    launchScreens: function (launchScreens) {\n      const validDevices =\n        Object.keys(splashIosKeys).concat(Object.keys(splashAndroidKeys));\n\n      Object.keys(launchScreens).forEach((key) => {\n        if (!key in validDevices) {\n          Console.labelWarn(`${key}: unknown key in App.launchScreens \\\nconfiguration. The key may be deprecated.`);\n        }\n      })\n      Object.assign(builder.imagePaths.splash, launchScreens);\n    },\n\n    /**\n     * @summary Set a new access rule based on origin domain for your app.\n     * By default your application has a limited list of servers it can contact.\n     * Use this method to extend this list.\n     *\n     * Default access rules:\n     *\n     * - `tel:*`, `geo:*`, `mailto:*`, `sms:*`, `market:*` are allowed and\n     *   are handled by the system (e.g. opened in the phone app or an email client)\n     * - `http://localhost:*` is used to serve the app's assets from.\n     * - The domain or address of the Meteor server to connect to for DDP and\n     *   hot code push of new versions.\n     *\n     * Read more about domain patterns in [Cordova\n     * docs](http://cordova.apache.org/docs/en/6.0.0/guide_appdev_whitelist_index.md.html).\n     *\n     * Starting with Meteor 1.0.4 access rule for all domains and protocols\n     * (`<access origin=\"*\"/>`) is no longer set by default due to\n     * [certain kind of possible\n     * attacks](http://cordova.apache.org/announcements/2014/08/04/android-351.html).\n     *\n     * @param {String} pattern The pattern defining affected domains or URLs.\n     * @param {Object} [options]\n     * @param {String} options.type Possible values:\n     * - **`'intent'`**: Controls which URLs the app is allowed to ask the system to open.\n     *  (e.g. in the phone app or an email client).\n     * - **`'navigation'`**: Controls which URLs the WebView itself can be navigated to\n     *  (can also needed for iframes).\n     * - **`'network'` or undefined**: Controls which network requests (images, XHRs, etc) are allowed to be made.\n     * @param {Boolean} options.launchExternal (Deprecated, use `type: 'intent'` instead.)\n     * @memberOf App\n     */\n    accessRule: function (pattern, options) {\n      options = options || {};\n\n      if (options.launchExternal) {\n        options.type = 'intent';\n      }\n\n      builder.accessRules[pattern] = options;\n    },\n\n    /**\n     * @summary Append custom tags into config's widget element.\n     *\n     * `App.appendToConfig('<any-xml-content/>');`\n     *\n     * @param  {String} element The XML you want to include\n     * @memberOf App\n     */\n    appendToConfig: function (xml) {\n      builder.custom.push(xml);\n    },\n\n    /**\n     * @summary Add a resource file for your build as described in the\n     * [Cordova documentation](http://cordova.apache.org/docs/en/7.x/config_ref/index.html#resource-file).\n     * @param {String} src The project resource path.\n     * @param {String} target Resource destination in build.\n     * @param {String} [platform] Optional. A platform name (either `ios` or `android`, both if ommited) to add a resource-file entry.\n     * @memberOf App\n     */\n    addResourceFile: function (src, target, platform) {\n      builder.resourceFiles.push({\n        src: src,\n        target: target,\n        platform: platform\n      });\n    }\n  };\n}\n"],"file":"tools/cordova/builder.js.map"}