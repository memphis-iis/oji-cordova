{"version":3,"sources":["/tools/cordova/builder.js"],"names":["module","export","CordovaBuilder","_","link","default","v","util","url","path","Console","buildmessage","files","optimisticReadJsonOrNull","bundler","archinfo","release","loadIsopackage","utils","XmlBuilder","CORDOVA_ARCH","SWIFT_VERSION","iconsIosSizes","iconsAndroidSizes","launchIosSizes","launchAndroidSizes","constructor","projectContext","projectRoot","options","resourcesPath","pathJoin","initalizeDefaults","createCordovaServerPort","appIdentifier","appIdAsNumber","parseInt","cordovaServerPort","metadata","id","version","buildNumber","undefined","name","pathBasename","projectDir","description","author","email","website","contentUrl","additionalConfiguration","global","platform","ios","android","custom","resourceFiles","packageMap","getInfo","AutoHideSplashScreen","SplashScreen","SplashScreenDelay","FadeSplashScreenDuration","ShowSplashScreenSpinner","StatusBarOverlaysWebView","StatusBarStyle","accessRules","type","mobileServerUrl","serverDomain","parseUrl","hostname","isIPv4Address","imagePaths","icon","splash","assetsPath","__dirname","iconsPath","launchScreensPath","setDefaultIcon","size","imageFile","exists","setDefaultLaunchScreen","each","pluginsConfiguration","processControlFile","controlFilePath","debug","enterJob","title","code","readFile","runJavaScript","filename","symbols","App","createAppConfiguration","error","exception","writeConfigXmlAndCopyResources","shouldCopyResources","config","create","ele","xmlns","value","key","att","txt","href","toString","elementSet","tag","src","pattern","omit","Object","assign","origin","platformElement","prefs","process","env","NODE_ENV","rm_recursive","mkdir_p","configureAndCopyImages","configureAndCopyResourceFiles","configXmlPath","formattedXmlConfig","end","prettyPrint","writeFile","sizes","xmlElement","imageAttributes","width","height","androidMatch","exec","attributes","density","substr","split","suppliedPath","suppliedFilename","last","pathSep","extension","match","copyFile","pathResolve","iosElement","androidElement","resourceFile","filepath","target","copyWWW","bundlePath","wwwPath","applicationPath","programPath","cp_r","programJsonPath","convertToOSPath","program","JSON","parse","settingsFile","settings","publicSettings","appendVersion","stringify","bootstrapPage","generateBootstrapPage","await","configDummy","PUBLIC_SETTINGS","WebAppHashing","AUTOUPDATE_VERSION","calculateClientHash","manifest","versionRefreshable","versionNonRefreshable","replaceable","versionReplaceable","_type","meteorRelease","current","isCheckout","hmrVersion","buildMode","Date","now","parsedUrl","runtimeConfig","gitCommitHash","METEOR_GIT_COMMIT_HASH","findGitCommitHash","ROOT_URL","ROOT_URL_PATH_PREFIX","pathname","replace","DDP_DEFAULT_CONNECTION_URL","autoupdate","versions","versionHmr","appId","meteorEnv","TEST_METADATA","Boilerplate","boilerplate","urlMapper","identity","pathMapper","baseDataExtension","meteorRuntimeConfig","encodeURIComponent","toHTMLAsync","copyBuildOverride","buildOverridePath","stat","isDirectory","builder","Error","info","has","setPreference","includes","configurePlugin","icons","validDevices","keys","concat","include","labelWarn","launchScreens","accessRule","launchExternal","appendToConfig","xml","push","addResourceFile"],"mappings":"AAAAA,MAAM,CAACC,MAAP,CAAc;AAACC,EAAAA,cAAc,EAAC,MAAIA;AAApB,CAAd;;AAAmD,IAAIC,CAAJ;;AAAMH,MAAM,CAACI,IAAP,CAAY,YAAZ,EAAyB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACH,IAAAA,CAAC,GAACG,CAAF;AAAI;;AAAhB,CAAzB,EAA2C,CAA3C;AAA8C,IAAIC,IAAJ;AAASP,MAAM,CAACI,IAAP,CAAY,MAAZ,EAAmB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACC,IAAAA,IAAI,GAACD,CAAL;AAAO;;AAAnB,CAAnB,EAAwC,CAAxC;AAA2C,IAAIE,GAAJ;AAAQR,MAAM,CAACI,IAAP,CAAY,KAAZ,EAAkB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACE,IAAAA,GAAG,GAACF,CAAJ;AAAM;;AAAlB,CAAlB,EAAsC,CAAtC;AAAyC,IAAIG,IAAJ;AAAST,MAAM,CAACI,IAAP,CAAY,MAAZ,EAAmB;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACG,IAAAA,IAAI,GAACH,CAAL;AAAO;;AAAnB,CAAnB,EAAwC,CAAxC;AAA2C,IAAII,OAAJ;AAAYV,MAAM,CAACI,IAAP,CAAY,uBAAZ,EAAoC;AAACM,EAAAA,OAAO,CAACJ,CAAD,EAAG;AAACI,IAAAA,OAAO,GAACJ,CAAR;AAAU;;AAAtB,CAApC,EAA4D,CAA5D;AAA+D,IAAIK,YAAJ;AAAiBX,MAAM,CAACI,IAAP,CAAY,0BAAZ,EAAuC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACK,IAAAA,YAAY,GAACL,CAAb;AAAe;;AAA3B,CAAvC,EAAoE,CAApE;AAAuE,IAAIM,KAAJ;AAAUZ,MAAM,CAACI,IAAP,CAAY,aAAZ,EAA0B;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACM,IAAAA,KAAK,GAACN,CAAN;AAAQ;;AAApB,CAA1B,EAAgD,CAAhD;AAAmD,IAAIO,wBAAJ;AAA6Bb,MAAM,CAACI,IAAP,CAAY,kBAAZ,EAA+B;AAACS,EAAAA,wBAAwB,CAACP,CAAD,EAAG;AAACO,IAAAA,wBAAwB,GAACP,CAAzB;AAA2B;;AAAxD,CAA/B,EAAyF,CAAzF;AAA4F,IAAIQ,OAAJ;AAAYd,MAAM,CAACI,IAAP,CAAY,wBAAZ,EAAqC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACQ,IAAAA,OAAO,GAACR,CAAR;AAAU;;AAAtB,CAArC,EAA6D,CAA7D;AAAgE,IAAIS,QAAJ;AAAaf,MAAM,CAACI,IAAP,CAAY,mBAAZ,EAAgC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACS,IAAAA,QAAQ,GAACT,CAAT;AAAW;;AAAvB,CAAhC,EAAyD,CAAzD;AAA4D,IAAIU,OAAJ;AAAYhB,MAAM,CAACI,IAAP,CAAY,yBAAZ,EAAsC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACU,IAAAA,OAAO,GAACV,CAAR;AAAU;;AAAtB,CAAtC,EAA8D,EAA9D;AAAkE,IAAIW,cAAJ;AAAmBjB,MAAM,CAACI,IAAP,CAAY,2BAAZ,EAAwC;AAACa,EAAAA,cAAc,CAACX,CAAD,EAAG;AAACW,IAAAA,cAAc,GAACX,CAAf;AAAiB;;AAApC,CAAxC,EAA8E,EAA9E;AAAkF,IAAIY,KAAJ;AAAUlB,MAAM,CAACI,IAAP,CAAY,mBAAZ,EAAgC;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACY,IAAAA,KAAK,GAACZ,CAAN;AAAQ;;AAApB,CAAhC,EAAsD,EAAtD;AAA0D,IAAIa,UAAJ;AAAenB,MAAM,CAACI,IAAP,CAAY,aAAZ,EAA0B;AAACC,EAAAA,OAAO,CAACC,CAAD,EAAG;AAACa,IAAAA,UAAU,GAACb,CAAX;AAAa;;AAAzB,CAA1B,EAAqD,EAArD;AAAyD,IAAIc,YAAJ,EAAiBC,aAAjB;AAA+BrB,MAAM,CAACI,IAAP,CAAY,YAAZ,EAAyB;AAACgB,EAAAA,YAAY,CAACd,CAAD,EAAG;AAACc,IAAAA,YAAY,GAACd,CAAb;AAAe,GAAhC;;AAAiCe,EAAAA,aAAa,CAACf,CAAD,EAAG;AAACe,IAAAA,aAAa,GAACf,CAAd;AAAgB;;AAAlE,CAAzB,EAA6F,EAA7F;AAiB5kC;AAEA,MAAMgB,aAAa,GAAG;AACpB,eAAa,WADO;AAEpB,eAAa,SAFO;AAGpB,eAAa,SAHO;AAIpB,aAAW,SAJS;AAKpB,cAAY,SALQ;AAMpB,qBAAmB,OANC;AAOpB,qBAAmB,OAPC;AAQpB,sBAAoB,OARA;AASpB,sBAAoB,SATA;AAUpB,yBAAuB,OAVH;AAWpB,yBAAuB,OAXH;AAYpB;AACA,UAAQ,OAbY;AAcpB,kBAAgB,OAdI;AAepB,mBAAiB,OAfG;AAgBpB,sBAAoB,OAhBA;AAiBpB,mBAAiB,OAjBG;AAkBpB,sBAAoB,SAlBA;AAmBpB,2BAAyB,OAnBL;AAoBpB,8BAA4B,SApBR;AAqBpB,qBAAmB,OArBC;AAsBpB,wBAAsB;AAtBF,CAAtB;AAyBA,MAAMC,iBAAiB,GAAG;AACxB,kBAAgB,OADQ;AAExB,kBAAgB,OAFQ;AAGxB,mBAAiB,OAHO;AAIxB,oBAAkB,SAJM;AAKxB,qBAAmB;AALK,CAA1B;AAQA,MAAMC,cAAc,GAAG;AACrB,aAAW,UADU;AAErB,aAAW,UAFU;AAGrB,uBAAqB,WAHA;AAIrB,wBAAsB,WAJD;AAKrB,sBAAoB,WALC;AAMrB,uBAAqB,WANA;AAOrB,sBAAoB,WAPC;AAQrB,uBAAqB,WARA;AASrB;AACA,YAAU,SAVW;AAWrB,eAAa,SAXQ;AAYrB,mBAAiB,UAZI;AAarB,oBAAkB;AAbG,CAAvB;AAgBA,MAAMC,kBAAkB,GAAG;AACzB,2BAAyB,SADA;AAEzB,4BAA0B,SAFD;AAGzB,2BAAyB,SAHA;AAIzB,4BAA0B,SAJD;AAKzB,4BAA0B,UALD;AAMzB,6BAA2B,UANF;AAOzB,6BAA2B,UAPF;AAQzB,8BAA4B,UARH;AASzB,8BAA4B,WATH;AAUzB,+BAA6B;AAVJ,CAA3B;;AAaO,MAAMvB,cAAN,CAAqB;AAC1BwB,EAAAA,WAAW,CAACC,cAAD,EAAiBC,WAAjB,EAA8BC,OAA9B,EAAuC;AAChD,SAAKF,cAAL,GAAsBA,cAAtB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,OAAL,GAAeA,OAAf;AAEA,SAAKC,aAAL,GAAqBlB,KAAK,CAACmB,QAAN,CACnB,KAAKH,WADc,EAEnB,WAFmB,CAArB;AAIA,SAAKI,iBAAL;AACD;;AAE6B,SAAvBC,uBAAuB,CAACC,aAAD,EAAgB;AAC5C;AACA,UAAMC,aAAa,GAAGC,QAAQ,CAACF,aAAD,EAAgB,EAAhB,CAA9B,CAF4C,CAG5C;AACA;AACA;AACA;AACA;;AACA,WAAO,QAASC,aAAa,GAAG,IAAhC;AACD;;AAEDH,EAAAA,iBAAiB,GAAG;AAClB,QAAI;AAAEK,MAAAA;AAAF,QAAwB,KAAKR,OAAjC,CADkB,CAElB;;AACA,QAAI,CAACQ,iBAAL,EAAwB;AACtBA,MAAAA,iBAAiB,GAAGnC,cAAc,CAAC+B,uBAAf,CAClB,KAAKN,cAAL,CAAoBO,aADF,CAApB;AAGD;;AAED,SAAKI,QAAL,GAAgB;AACdC,MAAAA,EAAE,EAAE,WAAW,KAAKZ,cAAL,CAAoBO,aADrB;AAEdM,MAAAA,OAAO,EAAE,OAFK;AAGdC,MAAAA,WAAW,EAAEC,SAHC;AAIdC,MAAAA,IAAI,EAAE/B,KAAK,CAACgC,YAAN,CAAmB,KAAKjB,cAAL,CAAoBkB,UAAvC,CAJQ;AAKdC,MAAAA,WAAW,EAAE,uBALC;AAMdC,MAAAA,MAAM,EAAE,oBANM;AAOdC,MAAAA,KAAK,EAAE,KAPO;AAQdC,MAAAA,OAAO,EAAE,KARK;AASdC,MAAAA,UAAU,6BAAsBb,iBAAtB;AATI,KAAhB,CATkB,CAqBlB;;AACA,SAAKc,uBAAL,GAA+B;AAC7BC,MAAAA,MAAM,EAAE;AACN,yBAAiB,KADX;AAEN,8BAAsB,IAFhB;AAGN,yBAAiB,IAHX;AAIN,wBAAgB/B;AAJV,OADqB;AAO7BgC,MAAAA,QAAQ,EAAE;AACRC,QAAAA,GAAG,EAAE,EADG;AAERC,QAAAA,OAAO,EAAE;AACP,6BAAmB,IADZ;AAEP;AACA;AACA;AACA,0CAAyBlB,iBAAzB,CALO;AAMP,4CAAkC;AAN3B;AAFD;AAPmB,KAA/B,CAtBkB,CA0ClB;;AACA,SAAKmB,MAAL,GAAc,EAAd,CA3CkB,CA6ClB;;AACA,SAAKC,aAAL,GAAqB,EAArB;AAEA,UAAMC,UAAU,GAAG,KAAK/B,cAAL,CAAoB+B,UAAvC;;AAEA,QAAIA,UAAU,IAAIA,UAAU,CAACC,OAAX,CAAmB,eAAnB,CAAlB,EAAuD;AACrD,WAAKR,uBAAL,CAA6BC,MAA7B,CAAoCQ,oBAApC,GAA2D,KAA3D;AACA,WAAKT,uBAAL,CAA6BC,MAA7B,CAAoCS,YAApC,GAAmD,QAAnD;AACA,WAAKV,uBAAL,CAA6BC,MAA7B,CAAoCU,iBAApC,GAAwD,IAAxD;AACA,WAAKX,uBAAL,CAA6BC,MAA7B,CAAoCW,wBAApC,GAA+D,GAA/D;AACA,WAAKZ,uBAAL,CAA6BC,MAA7B,CAAoCY,uBAApC,GAA8D,KAA9D;AACD;;AAED,QAAIN,UAAU,IAAIA,UAAU,CAACC,OAAX,CAAmB,mBAAnB,CAAlB,EAA2D;AACzD,WAAKR,uBAAL,CAA6BC,MAA7B,CAAoCa,wBAApC,GAA+D,KAA/D;AACA,WAAKd,uBAAL,CAA6BC,MAA7B,CAAoCc,cAApC,GAAqD,SAArD;AACD,KA7DiB,CA+DlB;AACA;;;AACA,SAAKC,WAAL,GAAmB;AACjB;AACA;AACA,eAAS;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAHQ;AAIjB,eAAS;AAAEA,QAAAA,IAAI,EAAE;AAAR,OAJQ;AAKjB,kBAAY;AAAEA,QAAAA,IAAI,EAAE;AAAR,OALK;AAMjB,eAAS;AAAEA,QAAAA,IAAI,EAAE;AAAR,OANQ;AAOjB,kBAAY;AAAEA,QAAAA,IAAI,EAAE;AAAR,OAPK;AAQjB,gBAAU;AAAEA,QAAAA,IAAI,EAAE;AAAR,OARO;AASjB,qBAAe;AAAEA,QAAAA,IAAI,EAAE;AAAR,OATE;AAWjB;AACA,0BAAoB;AAAEA,QAAAA,IAAI,EAAE;AAAR;AAZH,KAAnB;AAeA,UAAMC,eAAe,GAAG,KAAKxC,OAAL,CAAawC,eAArC;AACA,UAAMC,YAAY,GAAGD,eAAe,GAClCnD,KAAK,CAACqD,QAAN,CAAeF,eAAf,EAAgCG,QADE,GACS,IAD7C,CAjFkB,CAoFlB;AACA;;AACA,QAAIF,YAAJ,EAAkB;AAChB;AACA;AACA;AACA,UAAIpD,KAAK,CAACuD,aAAN,CAAoBH,YAApB,CAAJ,EAAuC;AACrC,aAAKH,WAAL,CAAiB,GAAjB,IAAwB;AAAEC,UAAAA,IAAI,EAAE;AAAR,SAAxB;AACD,OAFD,MAEO;AACL,aAAKD,WAAL,CAAiB,SAASG,YAA1B,IAA0C;AAAEF,UAAAA,IAAI,EAAE;AAAR,SAA1C,CADK,CAGL;AACA;AACA;;AACA,YAAIE,YAAY,KAAK,WAArB,EAAkC;AAChC,eAAKH,WAAL,CAAiB,cAAjB,IAAmC;AAAEC,YAAAA,IAAI,EAAE;AAAR,WAAnC;AACD;AACF;AACF;;AAED,SAAKM,UAAL,GAAkB;AAChBC,MAAAA,IAAI,EAAE,EADU;AAEhBC,MAAAA,MAAM,EAAE;AAFQ,KAAlB,CAxGkB,CA6GlB;;AACA,UAAMC,UAAU,GAAGjE,KAAK,CAACmB,QAAN,CAAe+C,SAAf,EAA0B,QAA1B,CAAnB;AACA,UAAMC,SAAS,GAAGnE,KAAK,CAACmB,QAAN,CAAe8C,UAAf,EAA2B,OAA3B,CAAlB;AACA,UAAMG,iBAAiB,GAAGpE,KAAK,CAACmB,QAAN,CAAe8C,UAAf,EAA2B,eAA3B,CAA1B;;AAEA,UAAMI,cAAc,GAAG,CAACC,IAAD,EAAOvC,IAAP,KAAgB;AACrC,YAAMwC,SAAS,GAAGvE,KAAK,CAACmB,QAAN,CAAegD,SAAf,EAA0BG,IAAI,GAAG,MAAjC,CAAlB;;AACA,UAAItE,KAAK,CAACwE,MAAN,CAAaD,SAAb,CAAJ,EAA6B;AAC3B,aAAKT,UAAL,CAAgBC,IAAhB,CAAqBhC,IAArB,IAA6BwC,SAA7B;AACD;AACF,KALD;;AAOA,UAAME,sBAAsB,GAAG,CAACH,IAAD,EAAOvC,IAAP,KAAgB;AAC7C,YAAMwC,SAAS,GAAGvE,KAAK,CAACmB,QAAN,CAAeiD,iBAAf,YAAqCE,IAArC,UAAlB;;AACA,UAAItE,KAAK,CAACwE,MAAN,CAAaD,SAAb,CAAJ,EAA6B;AAC3B,aAAKT,UAAL,CAAgBE,MAAhB,CAAuBjC,IAAvB,IAA+BwC,SAA/B;AACD;AACF,KALD;;AAOAhF,IAAAA,CAAC,CAACmF,IAAF,CAAOhE,aAAP,EAAsB2D,cAAtB;;AACA9E,IAAAA,CAAC,CAACmF,IAAF,CAAO/D,iBAAP,EAA0B0D,cAA1B;;AACA9E,IAAAA,CAAC,CAACmF,IAAF,CAAO9D,cAAP,EAAuB6D,sBAAvB;;AACAlF,IAAAA,CAAC,CAACmF,IAAF,CAAO7D,kBAAP,EAA2B4D,sBAA3B;;AAEA,SAAKE,oBAAL,GAA4B,EAA5B;AACD;;AAEDC,EAAAA,kBAAkB,GAAG;AACnB,UAAMC,eAAe,GACnB7E,KAAK,CAACmB,QAAN,CAAe,KAAKJ,cAAL,CAAoBkB,UAAnC,EAA+C,kBAA/C,CADF;;AAIA,QAAIjC,KAAK,CAACwE,MAAN,CAAaK,eAAb,CAAJ,EAAmC;AACjC/E,MAAAA,OAAO,CAACgF,KAAR,CAAc,6BAAd;AAEA/E,MAAAA,YAAY,CAACgF,QAAb,CAAsB;AAAEC,QAAAA,KAAK;AAAP,OAAtB,EAAgE,MAAM;AACpE,cAAMC,IAAI,GAAGjF,KAAK,CAACkF,QAAN,CAAeL,eAAf,EAAgC,MAAhC,CAAb;;AAEA,YAAI;AACF7E,UAAAA,KAAK,CAACmF,aAAN,CAAoBF,IAApB,EAA0B;AACxBG,YAAAA,QAAQ,EAAE,kBADc;AAExBC,YAAAA,OAAO,EAAE;AAAEC,cAAAA,GAAG,EAAEC,sBAAsB,CAAC,IAAD;AAA7B;AAFe,WAA1B;AAID,SALD,CAKE,OAAOC,KAAP,EAAc;AACdzF,UAAAA,YAAY,CAAC0F,SAAb,CAAuBD,KAAvB;AACD;AACF,OAXD;AAYD;AACF;;AAEDE,EAAAA,8BAA8B,GAA6B;AAAA,QAA5BC,mBAA4B,uEAAN,IAAM;AACzD,QAAIC,MAAM,GAAGrF,UAAU,CAACsF,MAAX,CAAkB;AAAEjE,MAAAA,OAAO,EAAE;AAAX,KAAlB,EAAsCkE,GAAtC,CAA0C,QAA1C,CAAb,CADyD,CAGzD;;AACAvG,IAAAA,CAAC,CAACmF,IAAF,CAAO;AACL/C,MAAAA,EAAE,EAAE,KAAKD,QAAL,CAAcC,EADb;AAELC,MAAAA,OAAO,EAAE,KAAKF,QAAL,CAAcE,OAFlB;AAGL,6BAAuB,KAAKF,QAAL,CAAcG,WAHhC;AAIL,6BAAuB,KAAKH,QAAL,CAAcG,WAJhC;AAKLkE,MAAAA,KAAK,EAAE,8BALF;AAML,mBAAa,kCANR;AAOL,uBAAiB;AAPZ,KAAP,EAQG,CAACC,KAAD,EAAQC,GAAR,KAAgB;AACjB,UAAID,KAAJ,EAAW;AACTJ,QAAAA,MAAM,CAACM,GAAP,CAAWD,GAAX,EAAgBD,KAAhB;AACD;AACF,KAZD,EAJyD,CAkBzD;;;AACAJ,IAAAA,MAAM,CAACE,GAAP,CAAW,MAAX,EAAmBK,GAAnB,CAAuB,KAAKzE,QAAL,CAAcK,IAArC;AACA6D,IAAAA,MAAM,CAACE,GAAP,CAAW,aAAX,EAA0BK,GAA1B,CAA8B,KAAKzE,QAAL,CAAcQ,WAA5C;AACA0D,IAAAA,MAAM,CAACE,GAAP,CAAW,QAAX,EAAqB;AACnBM,MAAAA,IAAI,EAAE,KAAK1E,QAAL,CAAcW,OADD;AAEnBD,MAAAA,KAAK,EAAE,KAAKV,QAAL,CAAcU;AAFF,KAArB,EAGG+D,GAHH,CAGO,KAAKzE,QAAL,CAAcS,MAHrB,EArByD,CA0BzD;;AACA5C,IAAAA,CAAC,CAACmF,IAAF,CAAO,KAAKnC,uBAAL,CAA6BC,MAApC,EAA4C,CAACwD,KAAD,EAAQC,GAAR,KAAgB;AAC1DL,MAAAA,MAAM,CAACE,GAAP,CAAW,YAAX,EAAyB;AACvB/D,QAAAA,IAAI,EAAEkE,GADiB;AAEvBD,QAAAA,KAAK,EAAEA,KAAK,CAACK,QAAN;AAFgB,OAAzB;AAID,KALD,EA3ByD,CAkCzD;;;AACA9G,IAAAA,CAAC,CAACmF,IAAF,CAAO,KAAK9B,MAAZ,EAAoB0D,UAAU,IAAI;AAChC,YAAMC,GAAG,GAAGX,MAAM,CAACE,GAAP,CAAWQ,UAAX,CAAZ;AACD,KAFD;;AAIAV,IAAAA,MAAM,CAACE,GAAP,CAAW,SAAX,EAAsB;AAAEU,MAAAA,GAAG,EAAE,KAAK9E,QAAL,CAAcY;AAArB,KAAtB,EAvCyD,CAyCzD;;AACA/C,IAAAA,CAAC,CAACmF,IAAF,CAAO,KAAKnB,WAAZ,EAAyB,CAACtC,OAAD,EAAUwF,OAAV,KAAsB;AAC7C,YAAMjD,IAAI,GAAGvC,OAAO,CAACuC,IAArB;AACAvC,MAAAA,OAAO,GAAG1B,CAAC,CAACmH,IAAF,CAAOzF,OAAP,EAAgB,MAAhB,CAAV;;AAEA,UAAIuC,IAAI,KAAK,QAAb,EAAuB;AACrBoC,QAAAA,MAAM,CAACE,GAAP,CAAW,cAAX,EAA2B;AAAEM,UAAAA,IAAI,EAAEK;AAAR,SAA3B;AACD,OAFD,MAEO,IAAIjD,IAAI,KAAK,YAAb,EAA2B;AAChCoC,QAAAA,MAAM,CAACE,GAAP,CAAW,kBAAX,EAA+Ba,MAAM,CAACC,MAAP,CAAc;AAAER,UAAAA,IAAI,EAAEK;AAAR,SAAd,EAAiCxF,OAAjC,CAA/B;AACD,OAFM,MAEA;AACL2E,QAAAA,MAAM,CAACE,GAAP,CAAW,QAAX,EAAqBa,MAAM,CAACC,MAAP,CAAc;AAAEC,UAAAA,MAAM,EAAEJ;AAAV,SAAd,EAAmCxF,OAAnC,CAArB;AACD;AACF,KAXD;;AAaA,UAAM6F,eAAe,GAAG;AACtBpE,MAAAA,GAAG,EAAEkD,MAAM,CAACE,GAAP,CAAW,UAAX,EAAuB;AAAE/D,QAAAA,IAAI,EAAE;AAAR,OAAvB,CADiB;AAEtBY,MAAAA,OAAO,EAAEiD,MAAM,CAACE,GAAP,CAAW,UAAX,EAAuB;AAAE/D,QAAAA,IAAI,EAAE;AAAR,OAAvB;AAFa,KAAxB,CAvDyD,CA4DzD;;AACAxC,IAAAA,CAAC,CAACmF,IAAF,CAAO,KAAKnC,uBAAL,CAA6BE,QAApC,EAA8C,CAACsE,KAAD,EAAQtE,QAAR,KAAqB;AACjElD,MAAAA,CAAC,CAACmF,IAAF,CAAOqC,KAAP,EAAc,CAACf,KAAD,EAAQC,GAAR,KAAgB;AAC5Ba,QAAAA,eAAe,CAACrE,QAAD,CAAf,CAA0BqD,GAA1B,CAA8B,YAA9B,EAA4C;AAC1C/D,UAAAA,IAAI,EAAEkE,GADoC;AAE1CD,UAAAA,KAAK,EAAEA,KAAK,CAACK,QAAN;AAFmC,SAA5C;AAID,OALD;AAMD,KAPD,EA7DyD,CAsEzD;;;AACA,QAAGW,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA5B,EAA0C;AACxCJ,MAAAA,eAAe,CAACnE,OAAhB,CAAwBmD,GAAxB,CAA4B,aAA5B,EACKI,GADL,CACS,MADT,EACiB,kCADjB,EAEKA,GAFL,CAES,MAFT,EAEiB,OAFjB,EAGKA,GAHL,CAGS,QAHT,EAGmB,uBAHnB,EAIKJ,GAJL,CAIS,aAJT,EAKKI,GALL,CAKS,8BALT,EAKyC,MALzC;AAMD;;AACD,QAAIP,mBAAJ,EAAyB;AACvB;AACA3F,MAAAA,KAAK,CAACmH,YAAN,CAAmB,KAAKjG,aAAxB;AACAlB,MAAAA,KAAK,CAACoH,OAAN,CAAc,KAAKlG,aAAnB;AAEApB,MAAAA,OAAO,CAACgF,KAAR,CAAc,mCAAd;AAEA,WAAKuC,sBAAL,CAA4B3G,aAA5B,EAA2CoG,eAAe,CAACpE,GAA3D,EAAgE,MAAhE;AACA,WAAK2E,sBAAL,CAA4B1G,iBAA5B,EAA+CmG,eAAe,CAACnE,OAA/D,EAAwE,MAAxE;AACA,WAAK0E,sBAAL,CAA4BzG,cAA5B,EAA4CkG,eAAe,CAACpE,GAA5D,EAAiE,QAAjE;AACA,WAAK2E,sBAAL,CAA4BxG,kBAA5B,EAAgDiG,eAAe,CAACnE,OAAhE,EAAyE,QAAzE;AACD;;AAED,SAAK2E,6BAAL,CACE,KAAKzE,aADP,EAEEiE,eAAe,CAACpE,GAFlB,EAGEoE,eAAe,CAACnE,OAHlB;AAMA7C,IAAAA,OAAO,CAACgF,KAAR,CAAc,wBAAd;AAEA,UAAMyC,aAAa,GAAGvH,KAAK,CAACmB,QAAN,CAAe,KAAKH,WAApB,EAAiC,YAAjC,CAAtB;AACA,UAAMwG,kBAAkB,GAAG5B,MAAM,CAAC6B,GAAP,CAAW;AAAEC,MAAAA,WAAW,EAAE;AAAf,KAAX,CAA3B;AACA1H,IAAAA,KAAK,CAAC2H,SAAN,CAAgBJ,aAAhB,EAA+BC,kBAA/B,EAAmD,MAAnD;AACD;;AAEDH,EAAAA,sBAAsB,CAACO,KAAD,EAAQC,UAAR,EAAoBtB,GAApB,EAAyB;AAC7C,UAAMuB,eAAe,GAAG,CAAC/F,IAAD,EAAOgG,KAAP,EAAcC,MAAd,EAAsBxB,GAAtB,KAA8B;AACpD,YAAMyB,YAAY,GAAG,yCAAyCC,IAAzC,CAA8CnG,IAA9C,CAArB;AAEA,UAAIoG,UAAU,GAAG;AACf3B,QAAAA,GAAG,EAAEA,GADU;AAEfuB,QAAAA,KAAK,EAAEA,KAFQ;AAGfC,QAAAA,MAAM,EAAEA;AAHO,OAAjB,CAHoD,CASpD;;AACA,UAAIC,YAAJ,EAAkB;AAChBE,QAAAA,UAAU,CAACC,OAAX,GACEH,YAAY,CAAC,CAAD,CAAZ,CAAgBI,MAAhB,CAAuB,CAAvB,EAA0B,CAA1B,IAA+B,GAA/B,GAAqCJ,YAAY,CAAC,CAAD,CADnD;AAED;;AAED,aAAOE,UAAP;AACD,KAhBD;;AAkBA5I,IAAAA,CAAC,CAACmF,IAAF,CAAOkD,KAAP,EAAc,CAACtD,IAAD,EAAOvC,IAAP,KAAgB;AAC5B,YAAM,CAACgG,KAAD,EAAQC,MAAR,IAAkB1D,IAAI,CAACgE,KAAL,CAAW,GAAX,CAAxB;AAEA,YAAMC,YAAY,GAAG,KAAKzE,UAAL,CAAgByC,GAAhB,EAAqBxE,IAArB,CAArB;;AACA,UAAI,CAACwG,YAAL,EAAmB;AACjB;AACD;;AAED,YAAMC,gBAAgB,GAAGjJ,CAAC,CAACkJ,IAAF,CAAOF,YAAY,CAACD,KAAb,CAAmBtI,KAAK,CAAC0I,OAAzB,CAAP,CAAzB;;AACA,UAAIC,SAAS,GAAGpJ,CAAC,CAACkJ,IAAF,CAAOD,gBAAgB,CAACF,KAAjB,CAAuB,GAAvB,CAAP,CAAhB,CAT4B,CAW5B;;;AACA,UAAIE,gBAAgB,CAACI,KAAjB,CAAuB,WAAvB,CAAJ,EAAyC;AACvCD,QAAAA,SAAS,GAAG,OAAZ;AACD;;AAED,YAAMvD,QAAQ,GAAGrD,IAAI,GAAG,GAAP,GAAawE,GAAb,GAAmB,GAAnB,GAAyBoC,SAA1C;AACA,YAAMnC,GAAG,GAAGxG,KAAK,CAACmB,QAAN,CAAe,WAAf,EAA4BiE,QAA5B,CAAZ,CAjB4B,CAmB5B;;AACApF,MAAAA,KAAK,CAAC6I,QAAN,CACE7I,KAAK,CAAC8I,WAAN,CAAkB,KAAK/H,cAAL,CAAoBkB,UAAtC,EAAkDsG,YAAlD,CADF,EAEEvI,KAAK,CAACmB,QAAN,CAAe,KAAKD,aAApB,EAAmCkE,QAAnC,CAFF,EApB4B,CAwB5B;;AACAyC,MAAAA,UAAU,CAAC/B,GAAX,CAAeS,GAAf,EAAoBuB,eAAe,CAAC/F,IAAD,EAAOgG,KAAP,EAAcC,MAAd,EAAsBxB,GAAtB,CAAnC;AACD,KA1BD;AA2BD;;AAEDc,EAAAA,6BAA6B,CAACzE,aAAD,EAAgBkG,UAAhB,EAA4BC,cAA5B,EAA4C;AACvEzJ,IAAAA,CAAC,CAACmF,IAAF,CAAO7B,aAAP,EAAsBoG,YAAY,IAAI;AACpC;AACA,UAAIC,QAAQ,GAAGlJ,KAAK,CAAC8I,WAAN,CAAkB,KAAK/H,cAAL,CAAoBkB,UAAtC,EAAkDgH,YAAY,CAACzC,GAA/D,CAAf;AACAxG,MAAAA,KAAK,CAAC6I,QAAN,CACEK,QADF,EAEElJ,KAAK,CAACmB,QAAN,CAAe,KAAKH,WAApB,EAAiC,gBAAjC,EAAmDkI,QAAnD,CAFF,EAHoC,CAMpC;;AACA,UAAI,CAACD,YAAY,CAACxG,QAAd,IACCwG,YAAY,CAACxG,QAAb,IAAyBwG,YAAY,CAACxG,QAAb,KAA0B,SADxD,EACoE;AAClEuG,QAAAA,cAAc,CAAClD,GAAf,CAAmB,eAAnB,EAAoC;AAClCU,UAAAA,GAAG,EAAExG,KAAK,CAACmB,QAAN,CAAe,gBAAf,EAAiC+H,QAAjC,CAD6B;AAElCC,UAAAA,MAAM,EAAEF,YAAY,CAACE;AAFa,SAApC;AAID;;AACD,UAAI,CAACF,YAAY,CAACxG,QAAd,IACCwG,YAAY,CAACxG,QAAb,IAAyBwG,YAAY,CAACxG,QAAb,KAA0B,KADxD,EACgE;AAC9DsG,QAAAA,UAAU,CAACjD,GAAX,CAAe,eAAf,EAAgC;AAC9BU,UAAAA,GAAG,EAAExG,KAAK,CAACmB,QAAN,CAAe,gBAAf,EAAiC+H,QAAjC,CADyB;AAE9BC,UAAAA,MAAM,EAAEF,YAAY,CAACE;AAFS,SAAhC;AAID;AACF,KArBD;AAsBD;;AAEDC,EAAAA,OAAO,CAACC,UAAD,EAAa;AAClB,UAAMC,OAAO,GAAGtJ,KAAK,CAACmB,QAAN,CAAe,KAAKH,WAApB,EAAiC,KAAjC,CAAhB,CADkB,CAGlB;;AACAhB,IAAAA,KAAK,CAACmH,YAAN,CAAmBmC,OAAnB,EAJkB,CAMlB;;AACA,UAAMC,eAAe,GAAGvJ,KAAK,CAACmB,QAAN,CAAemI,OAAf,EAAwB,aAAxB,CAAxB;AACAtJ,IAAAA,KAAK,CAACoH,OAAN,CAAcmC,eAAd,EARkB,CAUlB;;AACA,UAAMC,WAAW,GAAGxJ,KAAK,CAACmB,QAAN,CAAekI,UAAf,EAA2B,UAA3B,EAAuC7I,YAAvC,CAApB;AACAR,IAAAA,KAAK,CAACyJ,IAAN,CAAWD,WAAX,EAAwBD,eAAxB,EAZkB,CAclB;;AACA,UAAMG,eAAe,GAAG1J,KAAK,CAAC2J,eAAN,CACtB3J,KAAK,CAACmB,QAAN,CAAeoI,eAAf,EAAgC,cAAhC,CADsB,CAAxB;AAEA,UAAMK,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAW9J,KAAK,CAACkF,QAAN,CAAewE,eAAf,EAAgC,MAAhC,CAAX,CAAhB,CAjBkB,CAmBlB;;AACA,UAAMK,YAAY,GAAG,KAAK9I,OAAL,CAAa8I,YAAlC;AACA,UAAMC,QAAQ,GAAGD,YAAY,GAC3BF,IAAI,CAACC,KAAL,CAAW9J,KAAK,CAACkF,QAAN,CAAe6E,YAAf,EAA6B,MAA7B,CAAX,CAD2B,GACwB,EADrD;AAEA,UAAME,cAAc,GAAGD,QAAQ,CAAC,QAAD,CAA/B,CAvBkB,CAyBlB;;AACA,SAAKE,aAAL,CAAmBN,OAAnB,EAA4BK,cAA5B,EA1BkB,CA4BlB;;AACAjK,IAAAA,KAAK,CAAC2H,SAAN,CAAgB+B,eAAhB,EAAiCG,IAAI,CAACM,SAAL,CAAeP,OAAf,CAAjC,EAA0D,MAA1D;AAEA,UAAMQ,aAAa,GAAG,KAAKC,qBAAL,CACpBd,eADoB,EACHK,OADG,EACMK,cADN,EAEpBK,KAFoB,EAAtB;AAIAtK,IAAAA,KAAK,CAAC2H,SAAN,CAAgB3H,KAAK,CAACmB,QAAN,CAAeoI,eAAf,EAAgC,YAAhC,CAAhB,EACEa,aADF,EACiB,MADjB;AAED;;AAEDF,EAAAA,aAAa,CAACN,OAAD,EAAUK,cAAV,EAA0B;AACrC;AACA;AACA;AAEA,QAAIM,WAAW,GAAG,EAAlB;AACAA,IAAAA,WAAW,CAACC,eAAZ,GAA8BP,cAAc,IAAI,EAAhD;AAEA,UAAM;AAAEQ,MAAAA;AAAF,QAAoBpK,cAAc,CAAC,gBAAD,CAAxC;AACA,UAAM;AAAEqK,MAAAA;AAAF,QAAyB1D,OAAO,CAACC,GAAvC;AAEA2C,IAAAA,OAAO,CAAChI,OAAR,GAAkB8I,kBAAkB,IAClCD,aAAa,CAACE,mBAAd,CACEf,OAAO,CAACgB,QADV,EACoB,IADpB,EAC0BL,WAD1B,CADF;AAIAX,IAAAA,OAAO,CAACiB,kBAAR,GAA6BH,kBAAkB,IAC7CD,aAAa,CAACE,mBAAd,CACEf,OAAO,CAACgB,QADV,EACoBpH,IAAI,IAAIA,IAAI,KAAK,KADrC,EAC4C+G,WAD5C,CADF;AAIAX,IAAAA,OAAO,CAACkB,qBAAR,GAAgCJ,kBAAkB,IAChDD,aAAa,CAACE,mBAAd,CACEf,OAAO,CAACgB,QADV,EAEE,CAACpH,IAAD,EAAOuH,WAAP,KAAuBvH,IAAI,KAAK,KAAT,IAAkB,CAACuH,WAF5C,EAGER,WAHF,CADF;AAOAX,IAAAA,OAAO,CAACoB,kBAAR,GAA6BN,kBAAkB,IAC7CD,aAAa,CAACE,mBAAd,CACEf,OAAO,CAACgB,QADV,EAEE,CAACK,KAAD,EAAQF,WAAR,KAAwBA,WAF1B,EAGER,WAHF,CADF;AAMD;;AAEDF,EAAAA,qBAAqB,CAACd,eAAD,EAAkBK,OAAlB,EAA2BK,cAA3B,EAA2C;AAC9D,UAAMiB,aAAa,GACjB9K,OAAO,CAAC+K,OAAR,CAAgBC,UAAhB,KAA+B,MAA/B,GAAwChL,OAAO,CAAC+K,OAAR,CAAgBpJ,IAD1D;AAEA,UAAMsJ,UAAU,GACd,KAAKpK,OAAL,CAAaqK,SAAb,KAA2B,aAA3B,GAA2CC,IAAI,CAACC,GAAL,EAA3C,GAAwD1J,SAD1D;AAGA,UAAM8I,QAAQ,GAAGhB,OAAO,CAACgB,QAAzB;AAEA,UAAMnH,eAAe,GAAG,KAAKxC,OAAL,CAAawC,eAArC;AAEA,UAAMgI,SAAS,GAAG7L,GAAG,CAACkK,KAAJ,CAAUrG,eAAV,CAAlB;AAEA,UAAMiI,aAAa,GAAG;AACpBR,MAAAA,aAAa,EAAEA,aADK;AAEpBS,MAAAA,aAAa,EAAE3E,OAAO,CAACC,GAAR,CAAY2E,sBAAZ,IAAsC5L,KAAK,CAAC6L,iBAAN,CAAwBtC,eAAxB,CAFjC;AAGpBuC,MAAAA,QAAQ,EAAErI,eAHU;AAIpB;AACAsI,MAAAA,oBAAoB,EAAEN,SAAS,CAACO,QAAV,CAAmBC,OAAnB,CAA2B,KAA3B,EAAiC,EAAjC,KAAwC,EAL1C;AAMpBC,MAAAA,0BAA0B,EAAElF,OAAO,CAACC,GAAR,CAAYiF,0BAAZ,IAA0CzI,eANlD;AAOpB0I,MAAAA,UAAU,EAAE;AACVC,QAAAA,QAAQ,EAAE;AACR,yBAAe;AACbxK,YAAAA,OAAO,EAAEgI,OAAO,CAAChI,OADJ;AAEbiJ,YAAAA,kBAAkB,EAAEjB,OAAO,CAACiB,kBAFf;AAGbC,YAAAA,qBAAqB,EAAElB,OAAO,CAACkB,qBAHlB;AAIbE,YAAAA,kBAAkB,EAAEpB,OAAO,CAACoB,kBAJf;AAKbqB,YAAAA,UAAU,EAAEhB;AALC;AADP;AADA,OAPQ;AAkBpBiB,MAAAA,KAAK,EAAE,KAAKvL,cAAL,CAAoBO,aAlBP;AAmBpBiL,MAAAA,SAAS,EAAE;AACTrF,QAAAA,QAAQ,EAAEF,OAAO,CAACC,GAAR,CAAYC,QAAZ,IAAwB,YADzB;AAETsF,QAAAA,aAAa,EAAExF,OAAO,CAACC,GAAR,CAAYuF,aAAZ,IAA6B;AAFnC;AAnBS,KAAtB;;AAyBA,QAAIvC,cAAJ,EAAoB;AAClByB,MAAAA,aAAa,CAAClB,eAAd,GAAgCP,cAAhC;AACD;;AAED,UAAM;AAAEwC,MAAAA;AAAF,QAAkBpM,cAAc,CAAC,uBAAD,CAAtC;AAEA,UAAMqM,WAAW,GAAG,IAAID,WAAJ,CAAgBjM,YAAhB,EAA8BoK,QAA9B,EAAwC;AAC1D+B,MAAAA,SAAS,EAAEpN,CAAC,CAACqN,QAD6C;AAE1DC,MAAAA,UAAU,EAAGhN,IAAD,IAAUG,KAAK,CAAC2J,eAAN,CACpB3J,KAAK,CAACmB,QAAN,CAAeoI,eAAf,EAAgC1J,IAAhC,CADoB,CAFoC;AAI1DiN,MAAAA,iBAAiB,EAAE;AACjBC,QAAAA,mBAAmB,EAAElD,IAAI,CAACM,SAAL,CACnB6C,kBAAkB,CAACnD,IAAI,CAACM,SAAL,CAAeuB,aAAf,CAAD,CADC;AADJ;AAJuC,KAAxC,CAApB;AAUA,WAAOgB,WAAW,CAACO,WAAZ,EAAP;AACD;;AAEDC,EAAAA,iBAAiB,GAAG;AAClB,UAAMC,iBAAiB,GACrBnN,KAAK,CAACmB,QAAN,CAAe,KAAKJ,cAAL,CAAoBkB,UAAnC,EAA+C,wBAA/C,CADF;;AAGA,QAAIjC,KAAK,CAACwE,MAAN,CAAa2I,iBAAb,KACFnN,KAAK,CAACoN,IAAN,CAAWD,iBAAX,EAA8BE,WAA9B,EADF,EAC+C;AAC7CvN,MAAAA,OAAO,CAACgF,KAAR,CAAc,mDAAd;AACA9E,MAAAA,KAAK,CAACyJ,IAAN,CAAW0D,iBAAX,EAA8B,KAAKnM,WAAnC;AACD;AACF;;AAnfyB;;AAsf5B,SAASuE,sBAAT,CAAgC+H,OAAhC,EAAyC;AACvC,QAAM;AAAEvD,IAAAA;AAAF,MAAmBuD,OAAO,CAACrM,OAAjC;AACA,MAAI+I,QAAQ,GAAG,IAAf;;AACA,MAAID,YAAJ,EAAkB;AAChBC,IAAAA,QAAQ,GAAG/J,wBAAwB,CAAC8J,YAAD,CAAnC;;AACA,QAAI,CAACC,QAAL,EAAe;AACb,YAAM,IAAIuD,KAAJ,CAAU,iCAAiCxD,YAA3C,CAAN;AACD;AACF;AAED;AACF;AACA;AACA;AACA;;;AACE,SAAO;AACL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACIyD,IAAAA,IAAI,EAAE,UAAUvM,OAAV,EAAmB;AACvB;AACA1B,MAAAA,CAAC,CAACmF,IAAF,CAAOzD,OAAP,EAAgB,UAAU+E,KAAV,EAAiBC,GAAjB,EAAsB;AACpC,YAAI,CAAC1G,CAAC,CAACkO,GAAF,CAAMH,OAAO,CAAC5L,QAAd,EAAwBuE,GAAxB,CAAL,EAAmC;AACjC,gBAAM,IAAIsH,KAAJ,CAAU,4CAA4CtH,GAAtD,CAAN;AACD;AACF,OAJD;;AAMAU,MAAAA,MAAM,CAACC,MAAP,CAAc0G,OAAO,CAAC5L,QAAtB,EAAgCT,OAAhC;AACD,KAlBI;;AAmBL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACIyM,IAAAA,aAAa,EAAE,UAAUzH,GAAV,EAAeD,KAAf,EAAsBvD,QAAtB,EAAgC;AAC7C,UAAIA,QAAJ,EAAc;AACZ,YAAI,CAAC,CAAC,KAAD,EAAQ,SAAR,EAAmBkL,QAAnB,CAA4BlL,QAA5B,CAAL,EAA4C;AAC1C,gBAAM,IAAI8K,KAAJ,kDAAoD9K,QAApD,0CAAN;AAED;;AAED6K,QAAAA,OAAO,CAAC/K,uBAAR,CAAgCE,QAAhC,CAAyCA,QAAzC,EAAmDwD,GAAnD,IAA0DD,KAA1D;AACD,OAPD,MAOO;AACLsH,QAAAA,OAAO,CAAC/K,uBAAR,CAAgCC,MAAhC,CAAuCyD,GAAvC,IAA8CD,KAA9C;AACD;AACF,KAvCI;;AAyCL;AACJ;AACA;AACA;AACA;AACA;AACA;AACIgE,IAAAA,QAhDK;;AAkDL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACI4D,IAAAA,eAAe,EAAE,UAAUjM,EAAV,EAAciE,MAAd,EAAsB;AACrC0H,MAAAA,OAAO,CAAC3I,oBAAR,CAA6BhD,EAA7B,IAAmCiE,MAAnC;AACD,KA5DI;;AA8DL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACIiI,IAAAA,KAAK,EAAE,UAAUA,KAAV,EAAiB;AACtB,UAAIC,YAAY,GACdnH,MAAM,CAACoH,IAAP,CAAYrN,aAAZ,EAA2BsN,MAA3B,CAAkCrH,MAAM,CAACoH,IAAP,CAAYpN,iBAAZ,CAAlC,CADF;;AAEApB,MAAAA,CAAC,CAACmF,IAAF,CAAOmJ,KAAP,EAAc,UAAU7H,KAAV,EAAiBC,GAAjB,EAAsB;AAClC,YAAI,CAAC1G,CAAC,CAAC0O,OAAF,CAAUH,YAAV,EAAwB7H,GAAxB,CAAL,EAAmC;AACjCnG,UAAAA,OAAO,CAACoO,SAAR,WAAqBjI,GAArB;AAED;AACF,OALD;;AAMAU,MAAAA,MAAM,CAACC,MAAP,CAAc0G,OAAO,CAACxJ,UAAR,CAAmBC,IAAjC,EAAuC8J,KAAvC;AACD,KA3GI;;AA6GL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACIM,IAAAA,aAAa,EAAE,UAAUA,aAAV,EAAyB;AACtC,UAAIL,YAAY,GACdnH,MAAM,CAACoH,IAAP,CAAYnN,cAAZ,EAA4BoN,MAA5B,CAAmCrH,MAAM,CAACoH,IAAP,CAAYlN,kBAAZ,CAAnC,CADF;;AAGAtB,MAAAA,CAAC,CAACmF,IAAF,CAAOyJ,aAAP,EAAsB,UAAUnI,KAAV,EAAiBC,GAAjB,EAAsB;AAC1C,YAAI,CAAC1G,CAAC,CAAC0O,OAAF,CAAUH,YAAV,EAAwB7H,GAAxB,CAAL,EAAmC;AACjCnG,UAAAA,OAAO,CAACoO,SAAR,WAAqBjI,GAArB;AAED;AACF,OALD;;AAMAU,MAAAA,MAAM,CAACC,MAAP,CAAc0G,OAAO,CAACxJ,UAAR,CAAmBE,MAAjC,EAAyCmK,aAAzC;AACD,KA5JI;;AA8JL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACIC,IAAAA,UAAU,EAAE,UAAU3H,OAAV,EAAmBxF,OAAnB,EAA4B;AACtCA,MAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;;AAEA,UAAIA,OAAO,CAACoN,cAAZ,EAA4B;AAC1BpN,QAAAA,OAAO,CAACuC,IAAR,GAAe,QAAf;AACD;;AAED8J,MAAAA,OAAO,CAAC/J,WAAR,CAAoBkD,OAApB,IAA+BxF,OAA/B;AACD,KAtMI;;AAwML;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACIqN,IAAAA,cAAc,EAAE,UAAUC,GAAV,EAAe;AAC7BjB,MAAAA,OAAO,CAAC1K,MAAR,CAAe4L,IAAf,CAAoBD,GAApB;AACD,KAlNI;;AAoNL;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACIE,IAAAA,eAAe,EAAE,UAAUjI,GAAV,EAAe2C,MAAf,EAAuB1G,QAAvB,EAAiC;AAChD6K,MAAAA,OAAO,CAACzK,aAAR,CAAsB2L,IAAtB,CAA2B;AACzBhI,QAAAA,GAAG,EAAEA,GADoB;AAEzB2C,QAAAA,MAAM,EAAEA,MAFiB;AAGzB1G,QAAAA,QAAQ,EAAEA;AAHe,OAA3B;AAKD;AAlOI,GAAP;AAoOD","sourcesContent":["import _ from 'underscore';\nimport util from 'util';\nimport url from 'url';\nimport path from 'path';\nimport { Console } from '../console/console.js';\nimport buildmessage from '../utils/buildmessage.js';\nimport files from '../fs/files';\nimport { optimisticReadJsonOrNull } from \"../fs/optimistic\";\nimport bundler from '../isobuild/bundler.js';\nimport archinfo from '../utils/archinfo';\nimport release from '../packaging/release.js';\nimport { loadIsopackage } from '../tool-env/isopackets.js';\nimport utils from '../utils/utils.js';\nimport XmlBuilder from 'xmlbuilder2';\n\nimport { CORDOVA_ARCH, SWIFT_VERSION } from './index.js';\n\n// Hard-coded size constants\n\nconst iconsIosSizes = {\n  'app_store': '1024x1024',\n  'iphone_2x': '120x120',\n  'iphone_3x': '180x180',\n  'ipad_2x': '152x152',\n  'ipad_pro': '167x167',\n  'ios_settings_2x': '58x58',\n  'ios_settings_3x': '87x87',\n  'ios_spotlight_2x': '80x80',\n  'ios_spotlight_3x': '120x120',\n  'ios_notification_2x': '40x40',\n  'ios_notification_3x': '60x60',\n  // Legacy\n  'ipad': '76x76',\n  'ios_settings': '29x29',\n  'ios_spotlight': '40x40',\n  'ios_notification': '20x20',\n  'iphone_legacy': '57x57',\n  'iphone_legacy_2x': '114x114',\n  'ipad_spotlight_legacy': '50x50',\n  'ipad_spotlight_legacy_2x': '100x100',\n  'ipad_app_legacy': '72x72',\n  'ipad_app_legacy_2x': '144x144'\n};\n\nconst iconsAndroidSizes = {\n  'android_mdpi': '48x48',\n  'android_hdpi': '72x72',\n  'android_xhdpi': '96x96',\n  'android_xxhdpi': '144x144',\n  'android_xxxhdpi': '192x192'\n};\n\nconst launchIosSizes = {\n  'iphone5': '640x1136',\n  'iphone6': '750x1334',\n  'iphone6p_portrait': '1242x2208',\n  'iphone6p_landscape': '2208x1242',\n  'iphoneX_portrait': '1125x2436',\n  'iphoneX_landscape': '2436x1125',\n  'ipad_portrait_2x': '1536x2048',\n  'ipad_landscape_2x': '2048x1536',\n  // Legacy\n  'iphone': '320x480',\n  'iphone_2x': '640x960',\n  'ipad_portrait': '768x1024',\n  'ipad_landscape': '1024x768'\n};\n\nconst launchAndroidSizes = {\n  'android_mdpi_portrait': '320x480',\n  'android_mdpi_landscape': '480x320',\n  'android_hdpi_portrait': '480x800',\n  'android_hdpi_landscape': '800x480',\n  'android_xhdpi_portrait': '720x1280',\n  'android_xhdpi_landscape': '1280x720',\n  'android_xxhdpi_portrait': '960x1600',\n  'android_xxhdpi_landscape': '1600x960',\n  'android_xxxhdpi_portrait': '1280x1920',\n  'android_xxxhdpi_landscape': '1920x1280'\n};\n\nexport class CordovaBuilder {\n  constructor(projectContext, projectRoot, options) {\n    this.projectContext = projectContext;\n    this.projectRoot = projectRoot;\n    this.options = options;\n\n    this.resourcesPath = files.pathJoin(\n      this.projectRoot,\n      'resources');\n\n    this.initalizeDefaults();\n  }\n\n  static createCordovaServerPort(appIdentifier) {\n    // Convert the appId (a base 36 string) to a number\n    const appIdAsNumber = parseInt(appIdentifier, 36);\n    // We use the appId to choose a local server port between 12000-13000.\n    // This range should be large enough to avoid collisions with other\n    // Meteor apps, and has also been chosen to avoid collisions\n    // with other apps or services on the device (although this can never be\n    // guaranteed).\n    return 12000 + (appIdAsNumber % 1000);\n  }\n\n  initalizeDefaults() {\n    let { cordovaServerPort } = this.options;\n    // if --cordova-server-port is not present on run command\n    if (!cordovaServerPort) {\n      cordovaServerPort = CordovaBuilder.createCordovaServerPort(\n        this.projectContext.appIdentifier\n      );\n    }\n\n    this.metadata = {\n      id: 'com.id' + this.projectContext.appIdentifier,\n      version: '0.0.1',\n      buildNumber: undefined,\n      name: files.pathBasename(this.projectContext.projectDir),\n      description: 'New Meteor Mobile App',\n      author: 'A Meteor Developer',\n      email: 'n/a',\n      website: 'n/a',\n      contentUrl: `http://localhost:${cordovaServerPort}/`\n    };\n\n    // Set some defaults different from the Cordova defaults\n    this.additionalConfiguration = {\n      global: {\n        'webviewbounce': false,\n        'DisallowOverscroll': true,\n        'WKWebViewOnly': true,\n        'SwiftVersion': SWIFT_VERSION\n      },\n      platform: {\n        ios: {},\n        android: {\n          \"AndroidXEnabled\": true,\n          // we still use a port based on appId on iOS to avoid conflits on local webserver\n          // we dont need it on android, but the contentUrl can only be one, and we set this\n          // here to be able to intercept these calls\n          \"hostname\": `localhost:${cordovaServerPort}`,\n          \"AndroidInsecureFileModeEnabled\": true\n        }\n      }\n    };\n\n    // Custom elements that will be appended into config.xml's widgets\n    this.custom = [];\n\n    // Resource files that will be appended to platform bundle and config.xml\n    this.resourceFiles = [];\n\n    const packageMap = this.projectContext.packageMap;\n\n    if (packageMap && packageMap.getInfo('launch-screen')) {\n      this.additionalConfiguration.global.AutoHideSplashScreen = false;\n      this.additionalConfiguration.global.SplashScreen = 'screen';\n      this.additionalConfiguration.global.SplashScreenDelay = 5000;\n      this.additionalConfiguration.global.FadeSplashScreenDuration = 250;\n      this.additionalConfiguration.global.ShowSplashScreenSpinner = false;\n    }\n\n    if (packageMap && packageMap.getInfo('mobile-status-bar')) {\n      this.additionalConfiguration.global.StatusBarOverlaysWebView = false;\n      this.additionalConfiguration.global.StatusBarStyle = 'default';\n    }\n\n    // Default access rules.\n    // Rules can be extended with App.accesRule() in mobile-config.js.\n    this.accessRules = {\n      // Allow the app to ask the system to open these types of URLs.\n      // (e.g. in the phone app or an email client)\n      'tel:*': { type: 'intent' },\n      'geo:*': { type: 'intent' },\n      'mailto:*': { type: 'intent' },\n      'sms:*': { type: 'intent' },\n      'market:*': { type: 'intent' },\n      'itms:*': { type: 'intent' },\n      'itms-apps:*': { type: 'intent' },\n\n      // Allow navigation to localhost, which is needed for the local server\n      'http://localhost': { type: 'navigation' }\n    };\n\n    const mobileServerUrl = this.options.mobileServerUrl;\n    const serverDomain = mobileServerUrl ?\n      utils.parseUrl(mobileServerUrl).hostname : null;\n\n    // If the remote server domain is known, allow access to it for XHR and DDP\n    // connections.\n    if (serverDomain) {\n      // Application Transport Security (new in iOS 9) doesn't allow you\n      // to give access to IP addresses (just domains). So we allow access to\n      // everything if we don't have a domain, which sets NSAllowsArbitraryLoads.\n      if (utils.isIPv4Address(serverDomain)) {\n        this.accessRules['*'] = { type: 'network' };\n      } else {\n        this.accessRules['*://' + serverDomain] = { type: 'network' };\n\n        // Android talks to localhost over 10.0.2.2. This config file is used for\n        // multiple platforms, so any time that we say the server is on localhost we\n        // should also say it is on 10.0.2.2.\n        if (serverDomain === 'localhost') {\n          this.accessRules['*://10.0.2.2'] = { type: 'network' };\n        }\n      }\n    }\n\n    this.imagePaths = {\n      icon: {},\n      splash: {}\n    };\n\n    // Defaults are Meteor meatball images located in tools/cordova/assets directory\n    const assetsPath = files.pathJoin(__dirname, 'assets');\n    const iconsPath = files.pathJoin(assetsPath, 'icons');\n    const launchScreensPath = files.pathJoin(assetsPath, 'launchscreens');\n\n    const setDefaultIcon = (size, name) => {\n      const imageFile = files.pathJoin(iconsPath, size + '.png');\n      if (files.exists(imageFile)) {\n        this.imagePaths.icon[name] = imageFile;\n      }\n    };\n\n    const setDefaultLaunchScreen = (size, name) => {\n      const imageFile = files.pathJoin(launchScreensPath, `${size}.png`);\n      if (files.exists(imageFile)) {\n        this.imagePaths.splash[name] = imageFile;\n      }\n    };\n\n    _.each(iconsIosSizes, setDefaultIcon);\n    _.each(iconsAndroidSizes, setDefaultIcon);\n    _.each(launchIosSizes, setDefaultLaunchScreen);\n    _.each(launchAndroidSizes, setDefaultLaunchScreen);\n\n    this.pluginsConfiguration = {};\n  }\n\n  processControlFile() {\n    const controlFilePath =\n      files.pathJoin(this.projectContext.projectDir, 'mobile-config.js');\n\n\n    if (files.exists(controlFilePath)) {\n      Console.debug('Processing mobile-config.js');\n\n      buildmessage.enterJob({ title: `processing mobile-config.js` }, () => {\n        const code = files.readFile(controlFilePath, 'utf8');\n\n        try {\n          files.runJavaScript(code, {\n            filename: 'mobile-config.js',\n            symbols: { App: createAppConfiguration(this) }\n          });\n        } catch (error) {\n          buildmessage.exception(error);\n        }\n      });\n    }\n  }\n\n  writeConfigXmlAndCopyResources(shouldCopyResources = true) {\n    let config = XmlBuilder.create({ version: '1.0' }).ele('widget');\n\n    // Set the root attributes\n    _.each({\n      id: this.metadata.id,\n      version: this.metadata.version,\n      'android-versionCode': this.metadata.buildNumber,\n      'ios-CFBundleVersion': this.metadata.buildNumber,\n      xmlns: 'http://www.w3.org/ns/widgets',\n      'xmlns:cdv': 'http://cordova.apache.org/ns/1.0',\n      'xmlns:android': 'http://schemas.android.com/apk/res/android'\n    }, (value, key) => {\n      if (value) {\n        config.att(key, value);\n      }\n    });\n\n    // Set the metadata\n    config.ele('name').txt(this.metadata.name);\n    config.ele('description').txt(this.metadata.description);\n    config.ele('author', {\n      href: this.metadata.website,\n      email: this.metadata.email\n    }).txt(this.metadata.author);\n\n    // Set the additional global configuration preferences\n    _.each(this.additionalConfiguration.global, (value, key) => {\n      config.ele('preference', {\n        name: key,\n        value: value.toString()\n      });\n    });\n\n    // Set custom tags into widget element\n    _.each(this.custom, elementSet => {\n      const tag = config.ele(elementSet);\n    });\n\n    config.ele('content', { src: this.metadata.contentUrl });\n\n    // Copy all the access rules\n    _.each(this.accessRules, (options, pattern) => {\n      const type = options.type;\n      options = _.omit(options, 'type');\n\n      if (type === 'intent') {\n        config.ele('allow-intent', { href: pattern });\n      } else if (type === 'navigation') {\n        config.ele('allow-navigation', Object.assign({ href: pattern }, options));\n      } else {\n        config.ele('access', Object.assign({ origin: pattern }, options));\n      }\n    });\n\n    const platformElement = {\n      ios: config.ele('platform', { name: 'ios' }),\n      android: config.ele('platform', { name: 'android' })\n    }\n\n    // Set the additional platform-specific configuration preferences\n    _.each(this.additionalConfiguration.platform, (prefs, platform) => {\n      _.each(prefs, (value, key) => {\n        platformElement[platform].ele('preference', {\n          name: key,\n          value: value.toString()\n        });\n      });\n    });\n\n    // allow http communication only in development mode\n    if(process.env.NODE_ENV !== 'production') {\n      platformElement.android.ele(\"edit-config\")\n          .att(\"file\", \"app/src/main/AndroidManifest.xml\")\n          .att(\"mode\", \"merge\")\n          .att(\"target\", \"/manifest/application\")\n          .ele(\"application\")\n          .att(\"android:usesCleartextTraffic\", \"true\");\n    }\n    if (shouldCopyResources) {\n      // Prepare the resources folder\n      files.rm_recursive(this.resourcesPath);\n      files.mkdir_p(this.resourcesPath);\n\n      Console.debug('Copying resources for mobile apps');\n\n      this.configureAndCopyImages(iconsIosSizes, platformElement.ios, 'icon');\n      this.configureAndCopyImages(iconsAndroidSizes, platformElement.android, 'icon');\n      this.configureAndCopyImages(launchIosSizes, platformElement.ios, 'splash');\n      this.configureAndCopyImages(launchAndroidSizes, platformElement.android, 'splash');\n    }\n\n    this.configureAndCopyResourceFiles(\n      this.resourceFiles,\n      platformElement.ios,\n      platformElement.android\n    );\n\n    Console.debug('Writing new config.xml');\n\n    const configXmlPath = files.pathJoin(this.projectRoot, 'config.xml');\n    const formattedXmlConfig = config.end({ prettyPrint: true });\n    files.writeFile(configXmlPath, formattedXmlConfig, 'utf8');\n  }\n\n  configureAndCopyImages(sizes, xmlElement, tag) {\n    const imageAttributes = (name, width, height, src) => {\n      const androidMatch = /android_(.?.dpi)_(landscape|portrait)/g.exec(name);\n\n      let attributes = {\n        src: src,\n        width: width,\n        height: height\n      };\n\n      // XXX special case for Android\n      if (androidMatch) {\n        attributes.density =\n          androidMatch[2].substr(0, 4) + '-' + androidMatch[1];\n      }\n\n      return attributes;\n    };\n\n    _.each(sizes, (size, name) => {\n      const [width, height] = size.split('x');\n\n      const suppliedPath = this.imagePaths[tag][name];\n      if (!suppliedPath) {\n        return;\n      }\n\n      const suppliedFilename = _.last(suppliedPath.split(files.pathSep));\n      let extension = _.last(suppliedFilename.split('.'));\n\n      // XXX special case for 9-patch png's\n      if (suppliedFilename.match(/\\.9\\.png$/)) {\n        extension = '9.png';\n      }\n\n      const filename = name + '.' + tag + '.' + extension;\n      const src = files.pathJoin('resources', filename);\n\n      // Copy the file to the build folder with a standardized name\n      files.copyFile(\n        files.pathResolve(this.projectContext.projectDir, suppliedPath),\n        files.pathJoin(this.resourcesPath, filename));\n\n      // Set it to the xml tree\n      xmlElement.ele(tag, imageAttributes(name, width, height, src));\n    });\n  }\n\n  configureAndCopyResourceFiles(resourceFiles, iosElement, androidElement) {\n    _.each(resourceFiles, resourceFile => {\n      // Copy resource files in cordova project root ./resource-files directory keeping original absolute path\n      var filepath = files.pathResolve(this.projectContext.projectDir, resourceFile.src);\n      files.copyFile(\n        filepath,\n        files.pathJoin(this.projectRoot, \"resource-files\", filepath));\n      // And entry in config.xml\n      if (!resourceFile.platform ||\n          (resourceFile.platform && resourceFile.platform === \"android\")) {\n        androidElement.ele('resource-file', {\n          src: files.pathJoin(\"resource-files\", filepath),\n          target: resourceFile.target\n        });\n      }\n      if (!resourceFile.platform ||\n          (resourceFile.platform && resourceFile.platform === \"ios\")) {\n        iosElement.ele('resource-file', {\n          src: files.pathJoin(\"resource-files\", filepath),\n          target: resourceFile.target\n        });\n      }\n    });\n  }\n\n  copyWWW(bundlePath) {\n    const wwwPath = files.pathJoin(this.projectRoot, 'www');\n\n    // Remove existing www\n    files.rm_recursive(wwwPath);\n\n    // Create www and www/application directories\n    const applicationPath = files.pathJoin(wwwPath, 'application');\n    files.mkdir_p(applicationPath);\n\n    // Copy Cordova arch program from bundle to www/application\n    const programPath = files.pathJoin(bundlePath, 'programs', CORDOVA_ARCH);\n    files.cp_r(programPath, applicationPath);\n\n    // Load program.json\n    const programJsonPath = files.convertToOSPath(\n      files.pathJoin(applicationPath, 'program.json'));\n    const program = JSON.parse(files.readFile(programJsonPath, 'utf8'));\n\n    // Load settings\n    const settingsFile = this.options.settingsFile;\n    const settings = settingsFile ?\n      JSON.parse(files.readFile(settingsFile, 'utf8')) : {};\n    const publicSettings = settings['public'];\n\n    // Calculate client hash and append to program\n    this.appendVersion(program, publicSettings);\n\n    // Write program.json\n    files.writeFile(programJsonPath, JSON.stringify(program), 'utf8');\n\n    const bootstrapPage = this.generateBootstrapPage(\n      applicationPath, program, publicSettings\n    ).await();\n\n    files.writeFile(files.pathJoin(applicationPath, 'index.html'),\n      bootstrapPage, 'utf8');\n  }\n\n  appendVersion(program, publicSettings) {\n    // Note: these version calculations must be kept in agreement with\n    // generateClientProgram in packages/webapp/webapp_server.js, or hot\n    // code push will reload the app unnecessarily.\n\n    let configDummy = {};\n    configDummy.PUBLIC_SETTINGS = publicSettings || {};\n\n    const { WebAppHashing } = loadIsopackage('webapp-hashing');\n    const { AUTOUPDATE_VERSION } = process.env;\n\n    program.version = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest, null, configDummy);\n\n    program.versionRefreshable = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest, type => type === \"css\", configDummy);\n\n    program.versionNonRefreshable = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest,\n        (type, replaceable) => type !== \"css\" && !replaceable,\n        configDummy\n      );\n\n    program.versionReplaceable = AUTOUPDATE_VERSION ||\n      WebAppHashing.calculateClientHash(\n        program.manifest,\n        (_type, replaceable) => replaceable,\n        configDummy\n      );\n  }\n\n  generateBootstrapPage(applicationPath, program, publicSettings) {\n    const meteorRelease =\n      release.current.isCheckout() ? \"none\" : release.current.name;\n    const hmrVersion =\n      this.options.buildMode === 'development' ? Date.now() : undefined\n\n    const manifest = program.manifest;\n\n    const mobileServerUrl = this.options.mobileServerUrl;\n\n    const parsedUrl = url.parse(mobileServerUrl);\n\n    const runtimeConfig = {\n      meteorRelease: meteorRelease,\n      gitCommitHash: process.env.METEOR_GIT_COMMIT_HASH || files.findGitCommitHash(applicationPath),\n      ROOT_URL: mobileServerUrl,\n      // XXX propagate it from this.options?\n      ROOT_URL_PATH_PREFIX: parsedUrl.pathname.replace(/\\/$/,\"\") || '',\n      DDP_DEFAULT_CONNECTION_URL: process.env.DDP_DEFAULT_CONNECTION_URL || mobileServerUrl,\n      autoupdate: {\n        versions: {\n          \"web.cordova\": {\n            version: program.version,\n            versionRefreshable: program.versionRefreshable,\n            versionNonRefreshable: program.versionNonRefreshable,\n            versionReplaceable: program.versionReplaceable,\n            versionHmr: hmrVersion\n          }\n        }\n      },\n      appId: this.projectContext.appIdentifier,\n      meteorEnv: {\n        NODE_ENV: process.env.NODE_ENV || \"production\",\n        TEST_METADATA: process.env.TEST_METADATA || \"{}\"\n      }\n    };\n\n    if (publicSettings) {\n      runtimeConfig.PUBLIC_SETTINGS = publicSettings;\n    }\n\n    const { Boilerplate } = loadIsopackage('boilerplate-generator');\n\n    const boilerplate = new Boilerplate(CORDOVA_ARCH, manifest, {\n      urlMapper: _.identity,\n      pathMapper: (path) => files.convertToOSPath(\n        files.pathJoin(applicationPath, path)),\n      baseDataExtension: {\n        meteorRuntimeConfig: JSON.stringify(\n          encodeURIComponent(JSON.stringify(runtimeConfig)))\n      }\n    });\n\n    return boilerplate.toHTMLAsync();\n  }\n\n  copyBuildOverride() {\n    const buildOverridePath =\n      files.pathJoin(this.projectContext.projectDir, 'cordova-build-override');\n\n    if (files.exists(buildOverridePath) &&\n      files.stat(buildOverridePath).isDirectory()) {\n      Console.debug('Copying over the cordova-build-override directory');\n      files.cp_r(buildOverridePath, this.projectRoot);\n    }\n  }\n}\n\nfunction createAppConfiguration(builder) {\n  const { settingsFile } = builder.options;\n  let settings = null;\n  if (settingsFile) {\n    settings = optimisticReadJsonOrNull(settingsFile);\n    if (!settings) {\n      throw new Error(\"Unreadable --settings file: \" + settingsFile);\n    }\n  }\n\n  /**\n   * @namespace App\n   * @global\n   * @summary The App configuration object in mobile-config.js\n   */\n  return {\n    /**\n     * @summary Set your mobile app's core configuration information.\n     * @param {Object} options\n     * @param {String} [options.id,version,name,description,author,email,website]\n     * Each of the options correspond to a key in the app's core configuration\n     * as described in the [Cordova documentation](http://cordova.apache.org/docs/en/5.1.1/config_ref_index.md.html#The%20config.xml%20File_core_configuration_elements).\n     * @memberOf App\n     */\n    info: function (options) {\n      // check that every key is meaningful\n      _.each(options, function (value, key) {\n        if (!_.has(builder.metadata, key)) {\n          throw new Error(\"Unknown key in App.info configuration: \" + key);\n        }\n      });\n\n      Object.assign(builder.metadata, options);\n    },\n    /**\n     * @summary Add a preference for your build as described in the\n     * [Cordova documentation](http://cordova.apache.org/docs/en/5.1.1/config_ref_index.md.html#The%20config.xml%20File_global_preferences).\n     * @param {String} name A preference name supported by Cordova's\n     * `config.xml`.\n     * @param {String} value The value for that preference.\n     * @param {String} [platform] Optional. A platform name (either `ios` or `android`) to add a platform-specific preference.\n     * @memberOf App\n     */\n    setPreference: function (key, value, platform) {\n      if (platform) {\n        if (!['ios', 'android'].includes(platform)) {\n          throw new Error(`Unknown platform in App.setPreference: ${platform}. \\\nValid platforms are: ios, android.`);\n        }\n\n        builder.additionalConfiguration.platform[platform][key] = value;\n      } else {\n        builder.additionalConfiguration.global[key] = value;\n      }\n    },\n\n    /**\n     * @summary Like `Meteor.settings`, contains data read from a JSON\n     *          file provided via the `--settings` command-line option at\n     *          build time, or null if no settings were provided.\n     * @memberOf App\n     * @type {Object}\n     */\n    settings,\n\n    /**\n     * @summary Set the build-time configuration for a Cordova plugin.\n     * @param {String} id The identifier of the plugin you want to\n     * configure.\n     * @param {Object} config A set of key-value pairs which will be passed\n     * at build-time to configure the specified plugin.\n     * @memberOf App\n     */\n    configurePlugin: function (id, config) {\n      builder.pluginsConfiguration[id] = config;\n    },\n\n    /**\n     * @summary Set the icons for your mobile app.\n     * @param {Object} icons An Object where the keys are different\n     * devices and screen sizes, and values are image paths\n     * relative to the project root directory.\n     *\n     * Valid key values:\n     * - `app_store` (1024x1024) // Apple App Store\n     * - `iphone_2x` (120x120) // iPhone 5, SE, 6, 6s, 7, 8\n     * - `iphone_3x` (180x180) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ipad_2x` (152x152) // iPad, iPad mini\n     * - `ipad_pro` (167x167) // iPad Pro\n     * - `ios_settings_2x` (58x58) // iPhone 5, SE, 6, 6s, 7, 8, iPad, mini, Pro\n     * - `ios_settings_3x` (87x87) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ios_spotlight_2x` (80x80) // iPhone 5, SE, 6, 6s, 7, 8, iPad, mini, Pro\n     * - `ios_spotlight_3x` (120x120) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ios_notification_2x` (40x40) // iPhone 5, SE, 6, 6s, 7, 8, iPad, mini, Pro\n     * - `ios_notification_3x` (60x60 // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus, X\n     * - `ipad` (76x76) // Legacy\n     * - `ios_settings` (29x29) // Legacy\n     * - `ios_spotlight` (40x40) // Legacy\n     * - `ios_notification` (20x20) // Legacy\n     * - `iphone_legacy` (57x57) // Legacy\n     * - `iphone_legacy_2x` (114x114) // Legacy\n     * - `ipad_spotlight_legacy` (50x50) // Legacy\n     * - `ipad_spotlight_legacy_2x` (100x100) // Legacy\n     * - `ipad_app_legacy` (72x72) // Legacy\n     * - `ipad_app_legacy_2x` (144x144) // Legacy\n     * - `android_mdpi` (48x48)\n     * - `android_hdpi` (72x72)\n     * - `android_xhdpi` (96x96)\n     * - `android_xxhdpi` (144x144)\n     * - `android_xxxhdpi` (192x192)\n     * @memberOf App\n     */\n    icons: function (icons) {\n      var validDevices =\n        Object.keys(iconsIosSizes).concat(Object.keys(iconsAndroidSizes));\n      _.each(icons, function (value, key) {\n        if (!_.include(validDevices, key)) {\n          Console.labelWarn(`${key}: unknown key in App.icons \\\nconfiguration. The key may be deprecated.`);\n        }\n      });\n      Object.assign(builder.imagePaths.icon, icons);\n    },\n\n    /**\n     * @summary Set the launch screen images for your mobile app.\n     * @param {Object} launchScreens A dictionary where keys are different\n     * devices, screen sizes, and orientations, and the values are image paths\n     * relative to the project root directory.\n     *\n     * For Android, launch screen images should\n     * be special \"Nine-patch\" image files that specify how they should be\n     * stretched. See the [Android docs](https://developer.android.com/guide/topics/graphics/2d-graphics.html#nine-patch).\n     *\n     * Valid key values:\n     * - `iphone5` (640x1136) // iPhone 5, SE\n     * - `iphone6` (750x1334) // iPhone 6, 6s, 7, 8\n     * - `iphone6p_portrait` (1242x2208) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus\n     * - `iphone6p_landscape` (2208x1242) // iPhone 6 Plus, 6s Plus, 7 Plus, 8 Plus\n     * - `iphoneX_portrait` (1125x2436) // iPhone X\n     * - `iphoneX_landscape` (2436x1125) // iPhone X\n     * - `ipad_portrait_2x` (1536x2048) // iPad, iPad mini\n     * - `ipad_landscape_2x` (2048x1536) // iPad, iPad mini\n     * - `iphone` (320x480) // Legacy\n     * - `iphone_2x` (640x960) // Legacy\n     * - `ipad_portrait` (768x1024) // Legacy\n     * - `ipad_landscape` (1024x768) // Legacy\n     * - `android_mdpi_portrait` (320x480)\n     * - `android_mdpi_landscape` (480x320)\n     * - `android_hdpi_portrait` (480x800)\n     * - `android_hdpi_landscape` (800x480)\n     * - `android_xhdpi_portrait` (720x1280)\n     * - `android_xhdpi_landscape` (1280x720)\n     * - `android_xxhdpi_portrait` (960x1600)\n     * - `android_xxhdpi_landscape` (1600x960)\n     * - `android_xxxhdpi_portrait` (1280x1920)\n     * - `android_xxxhdpi_landscape` (1920x1280)\n     *\n     * @memberOf App\n     */\n    launchScreens: function (launchScreens) {\n      var validDevices =\n        Object.keys(launchIosSizes).concat(Object.keys(launchAndroidSizes));\n\n      _.each(launchScreens, function (value, key) {\n        if (!_.include(validDevices, key)) {\n          Console.labelWarn(`${key}: unknown key in App.launchScreens \\\nconfiguration. The key may be deprecated.`);\n        }\n      });\n      Object.assign(builder.imagePaths.splash, launchScreens);\n    },\n\n    /**\n     * @summary Set a new access rule based on origin domain for your app.\n     * By default your application has a limited list of servers it can contact.\n     * Use this method to extend this list.\n     *\n     * Default access rules:\n     *\n     * - `tel:*`, `geo:*`, `mailto:*`, `sms:*`, `market:*` are allowed and\n     *   are handled by the system (e.g. opened in the phone app or an email client)\n     * - `http://localhost:*` is used to serve the app's assets from.\n     * - The domain or address of the Meteor server to connect to for DDP and\n     *   hot code push of new versions.\n     *\n     * Read more about domain patterns in [Cordova\n     * docs](http://cordova.apache.org/docs/en/6.0.0/guide_appdev_whitelist_index.md.html).\n     *\n     * Starting with Meteor 1.0.4 access rule for all domains and protocols\n     * (`<access origin=\"*\"/>`) is no longer set by default due to\n     * [certain kind of possible\n     * attacks](http://cordova.apache.org/announcements/2014/08/04/android-351.html).\n     *\n     * @param {String} pattern The pattern defining affected domains or URLs.\n     * @param {Object} [options]\n     * @param {String} options.type Possible values:\n     * - **`'intent'`**: Controls which URLs the app is allowed to ask the system to open.\n     *  (e.g. in the phone app or an email client).\n     * - **`'navigation'`**: Controls which URLs the WebView itself can be navigated to\n     *  (can also needed for iframes).\n     * - **`'network'` or undefined**: Controls which network requests (images, XHRs, etc) are allowed to be made.\n     * @param {Boolean} options.launchExternal (Deprecated, use `type: 'intent'` instead.)\n     * @memberOf App\n     */\n    accessRule: function (pattern, options) {\n      options = options || {};\n\n      if (options.launchExternal) {\n        options.type = 'intent';\n      }\n\n      builder.accessRules[pattern] = options;\n    },\n\n    /**\n     * @summary Append custom tags into config's widget element.\n     *\n     * `App.appendToConfig('<any-xml-content/>');`\n     *\n     * @param  {String} element The XML you want to include\n     * @memberOf App\n     */\n    appendToConfig: function (xml) {\n      builder.custom.push(xml);\n    },\n\n    /**\n     * @summary Add a resource file for your build as described in the\n     * [Cordova documentation](http://cordova.apache.org/docs/en/7.x/config_ref/index.html#resource-file).\n     * @param {String} src The project resource path.\n     * @param {String} target Resource destination in build.\n     * @param {String} [platform] Optional. A platform name (either `ios` or `android`, both if ommited) to add a resource-file entry.\n     * @memberOf App\n     */\n    addResourceFile: function (src, target, platform) {\n      builder.resourceFiles.push({\n        src: src,\n        target: target,\n        platform: platform\n      });\n    }\n  };\n}\n"],"file":"tools/cordova/builder.js.map"}